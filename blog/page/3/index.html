
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pablo Cibraro (Cibrax)</title>
  <meta name="author" content="Cibrax">

  
  <meta name="description" content="For simple scenarios of Web API consumption where identity delegation is
not required, traditional http authentication schemas such as basic, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cibrax.me/blog/page/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/cibrax" rel="alternate" title="Pablo Cibraro (Cibrax)" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44468149-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Pablo Cibraro (Cibrax)</a></h1>
  
    <h2>All about software development.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/cibrax" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:cibrax.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/06/using-mac-authentication-for-simple-web-api-s-consumption/">Using MAC Authentication for Simple Web API’s Consumption</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-06T00:00:00-03:00" pubdate data-updated="true">Dec 6<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/12/06/using-mac-authentication-for-simple-web-api-s-consumption/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For simple scenarios of Web API consumption where identity delegation is
not required, traditional http authentication schemas such as basic,
certificates or digest are the most used nowadays. All these schemas
rely on sending the caller credentials or some representation of it in
every request message as part of the Authorization header, so they are
prone to suffer phishing attacks if they are not correctly secured at
transport level with https.</p>

<p>In addition, most client applications typically authenticate two
different things, the caller application and the user consuming the API
on behalf of that application. For most cases, the schema is simplified
by using a single set of username and password for authenticating both,
making necessary to store those credentials temporally somewhere in
memory.</p>

<p>The true is that you can use two different identities, one for the user
running the application, which you might authenticate just once during
the first call when the application is initialized, and another identity
for the application itself that you use on every call.</p>

<p>Some cloud vendors like Windows Azure or Amazon Web Services have
adopted an schema to authenticate the caller application based on a
Message Authentication Code (MAC) generated with a symmetric algorithm
using a key known by the two parties, the caller and the Web API.</p>

<p>The caller must include a MAC as part of the Authorization header
created from different pieces of information in the request message such
as the address, the host, and some other headers. The Web API can
authenticate the caller by using the key associated to it and validating
the attached MAC in the request message. In that way, no credentials are
sent as part of the request message, so there is no way an attacker to
intercept the message and get access to those credentials.</p>

<p>Anyways, this schema also suffers from some deficiencies that can
generate attacks. For example, brute force can be still used to infer
the key used for generating the MAC, and impersonate the original
caller. This can be mitigated by renewing keys in a relative short
period of time. This schema as any other can be complemented with
transport security.</p>

<p>Eran Rammer, one of the brains behind OAuth, has recently published an
specification of a protocol based on MAC for Http authentication called
Hawk. The initial version of the spec is available
<a href="https://github.com/hueniverse">here</a>. A curious fact is that the
specification per se does not exist, and the specification itself is the
code that Eran initially wrote using node.js.</p>

<p>In that implementation, you can associate a key to an user, so once the
MAC has been verified on the Web API, the user can be inferred from that
key. Also a timestamp is used to avoid replay attacks.</p>

<p>As a pet project, I decided to port that code to .NET using ASP.NET Web
API, which is available also in github under
<a href="https://github.com/pcibraro/hawknet">https://github.com/pcibraro/hawknet</a></p>

<p>Enjoy!.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/06/multitenancy-in-sql-azure/">Multitenancy in SQL Azure</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-06T00:00:00-03:00" pubdate data-updated="true">Dec 6<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/12/06/multitenancy-in-sql-azure/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you are building a SaaS application in Windows Azure that relies on
SQL Azure, it’s probably that you will need to support multiple tenants
at database level.</p>

<p>This is short overview of the different approaches you can use for
support that scenario,</p>

<p><strong>A different database per tenant</strong></p>

<p>A new database is created and assigned when a tenant is provisioned.</p>

<p>Pros</p>

<ul>
<li>Complete isolation between tenants. All the data for a tenant lives
in a database only he can access.</li>
</ul>


<p>Cons</p>

<ul>
<li>It’s not cost effective. SQL Azure databases are not cheap, and the
minimum size for a database is 1GB.  You might be paying for storage
that you don’t really use.</li>
<li>A different connection pool is required per database.</li>
<li>Updates must be replicated across all the databases</li>
<li>You need multiple backup strategies across all the databases</li>
</ul>


<p><strong>Multiple schemas in a database shared by all the tenants</strong></p>

<p>A single database is shared among all the tenants, but every tenant is
assigned to a different schema and database user.</p>

<p>Pros</p>

<ul>
<li>You only pay for a single database.</li>
<li>Data is isolated at database level. If the credentials for one
tenant is compromised, the rest of the data for the other tenants is
not.</li>
</ul>


<p>Cons</p>

<ul>
<li>You need to replicate all the database objects in every schema, so
the number of objects can increase indefinitely.</li>
<li>Updates must be replicated across all the schemas.</li>
<li>The connection pool for the database must maintain a different
connection per tenant (or set of credentials)</li>
<li>A different user is required per tenant, which is stored at server
level. You have to backup that user independently.</li>
</ul>


<p><strong>Centralizing the database access with store procedures in a database
shared by all the tenants</strong></p>

<p>A single database is shared among all the tenants, but nobody can read
the data directly from the tables. All the data operations are performed
through store procedures that centralize the access to the tenant data.
The store procedures contain some logic to map the database user to an
specific tenant.</p>

<p>Pros</p>

<ul>
<li>You only pay for a single database.</li>
<li>You only have a set of objects to maintain and backup.</li>
</ul>


<p>Cons</p>

<ul>
<li>There is no real isolation. All the data for the different tenants
is shared in the same tables.</li>
<li>You can not use traditional ORM like EF code first for consuming the
data.</li>
<li>A different user is required per tenant, which is stored at server
level. You have to backup that user independently.</li>
</ul>


<p><strong>SQL Federations</strong></p>

<p>A single database is shared among all the tenants, but a different
federation is used per tenant. A federation in few words, it’s a
mechanism for horizontal scaling in SQL Azure, which basically uses the
idea of logical partitions to distribute data based on certain criteria.</p>

<p>Pros</p>

<ul>
<li>You only have a single database with multiple federations.</li>
<li>You can use filtering in the connections to pick the right
federation, so any ORM could be used to consume the data.</li>
</ul>


<p>Cons</p>

<ul>
<li>There is no real isolation at that database level. The isolation is
enforced programmatically with federations.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/15/await-whenall-waitall-oh-my/">Await, WhenAll, WaitAll, Oh My!!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-15T00:00:00-03:00" pubdate data-updated="true">Nov 15<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/11/15/await-whenall-waitall-oh-my/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you are dealing with asynchronous work in .NET, you might know that
the Task class has become the main driver for wrapping asynchronous
calls. Although this class was officially introduced in .NET 4.0, the
programming model for consuming tasks was much more simplified in C#
5.0 in .NET 4.5 with the addition of the new async/await keywords. In a
nutshell, you can use these keywords to make asynchronous calls as if
they were sequential, and avoiding in that way any fork or callback in
the code. The compiler takes care of the rest.</p>

<p>I was yesterday writing some code for making multiple asynchronous calls
to backend services in parallel. The code looked as follow,</p>

<pre><code>var allResults = new List&lt;Result&gt;();
</code></pre>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
foreach(var provider in providers)
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
{
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
  var results = await provider.GetResults();
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
  allResults.AddRange(results);
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
}
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
return allResults;
</del></p>

<p>You see, I was using the await keyword to make multiple calls in
parallel. Something I did not consider was the overhead this code
implied after being compiled. I started an interesting discussion with
some smart folks in twitter. One of them, <a href="https://twitter.com/tourismgeek">Tugberk
Ugurlu</a>, had the brilliant idea of
actually write some code to make a performance comparison with another
approach using Task.WhenAll.</p>

<p>There are two additional methods you can use to wait for the results of
multiple calls in parallel, WhenAll and WaitAll.</p>

<p>WhenAll creates a new task and waits for results in that new task, so it
does not block the calling thread. WaitAll, on the other hand, blocks
the calling thread. This is the code Tugberk initially wrote, and I
modified afterwards to also show the results of WaitAll.</p>

<pre><code> class Program
</code></pre>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>{
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    private static Func&lt;Stopwatch, Task&gt;[] funcs = new Func&lt;Stopwatch, Task&gt;[] { 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        async (watch) =&gt; { watch.Start(); await Task.Delay(1000); 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>            Console.WriteLine("1000 one has been completed."); },
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        async (watch) =&gt; { await Task.Delay(1500); 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>            Console.WriteLine("1500 one has been completed."); },
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        async (watch) =&gt; { await Task.Delay(2000); 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>            Console.WriteLine("2000 one has been completed."); watch.Stop(); 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>            Console.WriteLine(watch.ElapsedMilliseconds + "ms has been elapsed."); }
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    };
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    static void Main(string[] args)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        Console.WriteLine("Await in loop work starts...");
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        DoWorkAsync().ContinueWith(task =&gt;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>            Console.WriteLine("Parallel work starts...");
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>            DoWorkInParallelAsync().ContinueWith(t =&gt;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>                {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>                    Console.WriteLine("WaitAll work starts...");
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>                    WaitForAll();
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>                });
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        });
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        Console.ReadLine();
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    static async Task DoWorkAsync()
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        Stopwatch watch = new Stopwatch();
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        foreach (var func in funcs)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>            await func(watch);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        }
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    static async Task DoWorkInParallelAsync()
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        Stopwatch watch = new Stopwatch();
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        await Task.WhenAll(funcs[0](watch), funcs[1](watch), funcs[2](watch));
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    static void WaitForAll()
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        Stopwatch watch = new Stopwatch();
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>        Task.WaitAll(funcs[0](watch), funcs[1](watch), funcs[2](watch));
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>}
</code></pre>

<p>~~~~</p>

<p>After running this code, the results were very concluding.</p>

<p>Await in loop work starts&hellip; \
1000 one has been completed. \
1500 one has been completed. \
2000 one has been completed. \
4532ms has been elapsed.</p>

<p>\
Parallel work starts&hellip; \
1000 one has been completed. \
1500 one has been completed. \
2000 one has been completed. \
2007ms has been elapsed. \</p>

<p>WaitAll work starts&hellip; \
1000 one has been completed. \
1500 one has been completed. \
2000 one has been completed. \
2009ms has been elapsed.</p>

<p>The await keyword in a loop does not really make the calls in parallel.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/10/unit-testing-asp-net-web-api-controllers-that-rely-on-the-urlhelper/">Unit Testing ASP.NET Web API Controllers That Rely on the UrlHelper</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-10T00:00:00-03:00" pubdate data-updated="true">Oct 10<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/10/10/unit-testing-asp-net-web-api-controllers-that-rely-on-the-urlhelper/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>UrlHelper is the class you can use in ASP.NET Web API to automatically
infer links from the routing table without hardcoding anything. For
example, the following code uses the helper to infer the location url
for a new resource,</p>

<pre><code>public HttpResponseMessage Post(User model)
</code></pre>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
{
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
  var response = Request.CreateResponse(HttpStatusCode.Created, user);
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
  var link = Url.Link(&ldquo;DefaultApi&rdquo;, new { id = id, controller = &ldquo;Users&rdquo; });
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
  response.Headers.Location = new Uri(link);
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
  return response;
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
}
</del></p>

<p>That code uses a previously defined route “DefaultApi”, which you might
configure in the HttpConfiguration object (This is the route generated
by default when you create a new Web API project).</p>

<p>The problem with UrlHelper is that it requires from some initialization
code before you can invoking it from a unit test (for testing the Post
method in this example). If you don’t initialize the HttpConfiguration
and Request instances associated to the controller from the unit test,
it will fail miserably.</p>

<p>After digging into the ASP.NET Web API source code a little bit, I could
figure out what the requirements for using the UrlHelper are. It relies
on the routing table configuration, and a few properties you need to add
to the HttpRequestMessage. The following code illustrates what’s needed,</p>

<pre><code>var controller = new UserController();
</code></pre>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
controller.Configuration = new HttpConfiguration();
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
var route = controller.Configuration.Routes.MapHttpRoute(
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>     name: "DefaultApi",
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>     routeTemplate: "api/{controller}/{id}",
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>     defaults: new { id = RouteParameter.Optional }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
);
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
var routeData = new HttpRouteData(route,
</del></p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>   new HttpRouteValueDictionary 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>   { 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>      { "id", "1" },
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>      { "controller", "Users" } 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}</p>

<pre><code>   }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
);
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
controller.Request = new HttpRequestMessage(HttpMethod.Post, &ldquo;<a href="http://localhost:9091/">http://localhost:9091/</a>&rdquo;);
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
controller.Request.Properties.Add(HttpPropertyKeys.HttpConfigurationKey, controller.Configuration);
</del></p>

<p><del> {style=&ldquo;font-size: 12px; font-family: consolas,&lsquo;Courier New&rsquo;,courier,monospace; margin: 0em; width: 100%; background-color: #ffffff&rdquo;}
controller.Request.Properties.Add(HttpPropertyKeys.HttpRouteDataKey, routeData);
</del></p>

<pre><code> 
</code></pre>

<p>The HttpRouteData instance should be initialized with the route values
you will use in the controller method (“id” and “controller” in this
example). Once you have correctly setup all those properties, you
shouldn’t have any problem to use the UrlHelper. There is no need to
mock anything else.</p>

<p>Enjoy!!.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/12/unit-and-integration-testing-with-the-web-api-httpclient/">Doing Unit and Integration Tests With the Web API HttpClient</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-12T00:00:00-03:00" pubdate data-updated="true">Sep 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/09/12/unit-and-integration-testing-with-the-web-api-httpclient/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the nice things about the new HttpClient in System.Net.Http is
the support for mocking responses or handling requests in a http server
hosted in-memory. While the first option is useful for scenarios in
which we want to test our client code in isolation (unit tests for
example), the second one enables more complete integration testing
scenarios that could include some more components in the stack such as
model binders or message handlers for example.  </p>

<p>The HttpClient can receive a HttpMessageHandler as argument in one of
its constructors.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">HttpClient</span> <span class="p">:</span> <span class="n">HttpMessageInvoker</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">public</span> <span class="nf">HttpClient</span><span class="p">();</span>
</span><span class='line'>   <span class="k">public</span> <span class="nf">HttpClient</span><span class="p">(</span><span class="n">HttpMessageHandler</span> <span class="n">handler</span><span class="p">);</span>
</span><span class='line'>   <span class="k">public</span> <span class="nf">HttpClient</span><span class="p">(</span><span class="n">HttpMessageHandler</span> <span class="n">handler</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">disposeHandler</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>For the first scenario, you can create a new HttpMessageHandler that
fakes the response, which you can use in your unit test. The only
requirement is that you somehow inject an HttpClient with this custom
handler in the client code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">FakeHttpMessageHandler</span> <span class="p">:</span> <span class="n">HttpMessageHandler</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">HttpResponseMessage</span> <span class="n">response</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="nf">FakeHttpMessageHandler</span><span class="p">(</span><span class="n">HttpResponseMessage</span> <span class="n">response</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>       <span class="k">this</span><span class="p">.</span><span class="n">response</span> <span class="p">=</span> <span class="n">response</span><span class="p">;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">protected</span> <span class="k">override</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">HttpResponseMessage</span><span class="p">&gt;</span> <span class="n">SendAsync</span><span class="p">(</span><span class="n">HttpRequestMessage</span> <span class="n">request</span><span class="p">,</span>
</span><span class='line'><span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">CancellationToken</span> <span class="n">cancellationToken</span><span class="p">)</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="kt">var</span> <span class="n">tcs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TaskCompletionSource</span><span class="p">&lt;</span><span class="n">HttpResponseMessage</span><span class="p">&gt;();</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">tcs</span><span class="p">.</span><span class="n">SetResult</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="n">tcs</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In an unit test, you can do something like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="kt">var</span> <span class="n">fakeResponse</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpResponse</span><span class="p">();</span>
</span><span class='line'><span class="kt">var</span> <span class="n">fakeHandler</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FakeHttpMessageHandler</span><span class="p">(</span><span class="n">fakeResponse</span><span class="p">);</span>
</span><span class='line'><span class="kt">var</span> <span class="n">httpClient</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="p">(</span><span class="n">fakeHandler</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">var</span> <span class="n">customerService</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CustomerService</span><span class="p">(</span><span class="n">httpClient</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Do something</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Asserts</span>
</span></code></pre></td></tr></table></div></figure>


<p>CustomerService in this case is the class under test, and the one that
receives an HttpClient initialized with our fake handler.</p>

<p>For the second scenario in integration tests, there is a In-Memory host
“System.Web.Http.HttpServer” that also derives from HttpMessageHandler
and you can use with a HttpClient instance in your test. This has been
discussed already in these two great posts from
<a href="http://pfelix.wordpress.com/2012/03/05/asp-net-web-api-in-memory-hosting/">Pedro</a>
and
<a href="http://www.strathweb.com/2012/06/asp-net-web-api-integration-testing-with-in-memory-hosting/">Filip</a>. </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/10/consuming-the-amazon-s3-service-from-a-win8-metro-application/">Consuming the Amazon S3 Service From a Win8 Metro Application</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-10T00:00:00-03:00" pubdate data-updated="true">Sep 10<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/09/10/consuming-the-amazon-s3-service-from-a-win8-metro-application/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As many of the existing Http APIs for Cloud Services, AWS also provides
a set of different platform SDKs for hiding many of complexities present
in the APIs. While there is a platform SDK for .NET, which is open
source and available in C#, that SDK does not work in Win8 Metro
Applications for the changes introduced in WinRT. WinRT offers a
complete different set of APIs for doing I/O operations such as doing
http calls or using cryptography for signing or encrypting data, two
aspects that are absolutely necessary for consuming AWS. All the I/O
APIs available as part of WinRT are asynchronous, and uses the TPL model
for .NET applications (HTML and JavaScript Metro applications use a
model based in promises, which is similar concept). </p>

<p>In the case of S3, the http Authorization header is used for two
purposes, authenticating clients and make sure the messages were not
altered while they were in transit. For doing that, it uses a signature
or hash of the message content and some of the headers using a symmetric
key (That&rsquo;s just one of the available mechanisms). Windows Azure for
example also uses the same mechanism in many of its APIs.</p>

<p>There are three challenges that any developer working for first time in
Metro will have to face to consume S3, the new WinRT APIs, the
asynchronous nature of them and the complexity introduced for generating
the Authorization header. Having said that, I decided to write this post
with some of the gotchas I found myself trying to consume this Amazon
service.</p>

<p>​1. Generating the signature for the Authorization header</p>

<p>All the cryptography APIs in WinRT are available under
Windows.Security.Cryptography namespace. Many of operations available in
these APIs uses the concept of buffers (IBuffer) for representing a
chunk of binary data. As you will see in the example below, these
buffers are mainly generated with the use of static methods in a WinRT
class CryptographicBuffer available as part of the namespace previously
mentioned.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="kt">string</span> <span class="nf">DeriveAuthToken</span><span class="p">(</span><span class="kt">string</span> <span class="n">resource</span><span class="p">,</span> <span class="kt">string</span> <span class="n">httpMethod</span><span class="p">,</span> <span class="kt">string</span> <span class="n">timestamp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="kt">var</span> <span class="n">stringToSign</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0}\n&quot;</span> <span class="p">+</span>
</span><span class='line'>      <span class="s">&quot;\n&quot;</span> <span class="p">+</span>
</span><span class='line'>      <span class="s">&quot;\n&quot;</span> <span class="p">+</span>
</span><span class='line'>      <span class="s">&quot;\n&quot;</span> <span class="p">+</span>
</span><span class='line'>      <span class="s">&quot;x-amz-date:{1}\n&quot;</span> <span class="p">+</span>
</span><span class='line'>      <span class="s">&quot;/{2}/&quot;</span><span class="p">,</span> <span class="n">httpMethod</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">resource</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="kt">var</span> <span class="n">algorithm</span> <span class="p">=</span> <span class="n">MacAlgorithmProvider</span><span class="p">.</span><span class="n">OpenAlgorithm</span><span class="p">(</span><span class="s">&quot;HMAC_SHA1&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="kt">var</span> <span class="n">keyMaterial</span> <span class="p">=</span> <span class="n">CryptographicBuffer</span><span class="p">.</span><span class="n">CreateFromByteArray</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">secret</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>   <span class="kt">var</span> <span class="n">hmacKey</span> <span class="p">=</span> <span class="n">algorithm</span><span class="p">.</span><span class="n">CreateKey</span><span class="p">(</span><span class="n">keyMaterial</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="kt">var</span> <span class="n">signature</span> <span class="p">=</span> <span class="n">CryptographicEngine</span><span class="p">.</span><span class="n">Sign</span><span class="p">(</span>
</span><span class='line'>                <span class="n">hmacKey</span><span class="p">,</span>
</span><span class='line'>                <span class="n">CryptographicBuffer</span><span class="p">.</span><span class="n">CreateFromByteArray</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">stringToSign</span><span class="p">))</span>
</span><span class='line'>            <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">return</span> <span class="n">CryptographicBuffer</span><span class="p">.</span><span class="n">EncodeToBase64String</span><span class="p">(</span><span class="n">signature</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The algorithm that determines the information or content you need to use
for generating the signature is very well described as part of the AWS
documentation. In this case, this method is generating a signature
required for creating a new bucket. A HmacSha1 hash is computed using a
secret or symetric key provided by AWS in the management console. \
 \
2. Sending an Http Request to the S3 service</p>

<p>WinRT also ships with the System.Net.Http.HttpClient that was first
introduced some months ago with ASP.NET Web API. This client provides a
rich interface on top the traditional WebHttpRequest class, and also
solves some of limitations found in this last one. There are a few
things that don&rsquo;t work with a raw WebHttpRequest such as setting the
Host header, which is something absolutely required for consuming S3.
Also, HttpClient is more friendly for doing unit tests, as it receives a
HttpMessageHandler as part of the constructor that can fake to emulate a
real http call. This is how the code for consuming the service with
HttpClient looks like,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">S3Response</span><span class="p">&gt;</span> <span class="n">CreateBucket</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">string</span> <span class="n">region</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">acl</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="kt">var</span> <span class="n">timestamp</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0:r}&quot;</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">auth</span> <span class="p">=</span> <span class="n">DeriveAuthToken</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpRequestMessage</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">Put</span><span class="p">,</span> <span class="s">&quot;http://s3.amazonaws.com/&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">request</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">Host</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0}.s3.amazonaws.com&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
</span><span class='line'>    <span class="n">request</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">TryAddWithoutValidation</span><span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s">&quot;AWS &quot;</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">key</span> <span class="p">+</span> <span class="s">&quot;:&quot;</span> <span class="p">+</span> <span class="n">auth</span><span class="p">);</span>
</span><span class='line'>    <span class="n">request</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;x-amz-date&quot;</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="p">();</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">SendAsync</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="n">S3Response</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>         <span class="n">Succeed</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span>
</span><span class='line'>         <span class="n">Message</span> <span class="p">=</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">Content</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">?</span>
</span><span class='line'>            <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">ReadAsStringAsync</span><span class="p">()</span> <span class="p">:</span> <span class="k">null</span>
</span><span class='line'>     <span class="p">};</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You will notice a few additional things in this code. By default,
HttpClient validates the values for some well-know headers, and
Authorization is one of them. It won&rsquo;t allow you to set a value with &ldquo;:&rdquo;
on it, which is something that S3 expects. However, that&rsquo;s not a problem
at all, as you can skip the validation by using the
TryAddWithoutValidation method. \
Also, the code is heavily relying on the new async and await keywords to
transform all the asynchronous calls into synchronous ones. In case you
would want to unit test this code and faking the call to the real S3
service, you should have to modify it to inject a custom
HttpMessageHandler into the HttpClient. The following implementation
illustrates this concept,</p>

<p>In case you would want to unit test this code and faking the call to the
real S3 service, you should have to modify it to inject a custom
HttpMessageHandler into the HttpClient. The following implementation
illustrates this concept,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">FakeHttpMessageHandler</span> <span class="p">:</span> <span class="n">HttpMessageHandler</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">HttpResponseMessage</span> <span class="n">response</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="nf">FakeHttpMessageHandler</span><span class="p">(</span><span class="n">HttpResponseMessage</span> <span class="n">response</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>       <span class="k">this</span><span class="p">.</span><span class="n">response</span> <span class="p">=</span> <span class="n">response</span><span class="p">;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">protected</span> <span class="k">override</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">HttpResponseMessage</span><span class="p">&gt;</span> <span class="n">SendAsync</span><span class="p">(</span><span class="n">HttpRequestMessage</span> <span class="n">request</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">CancellationToken</span> <span class="n">cancellationToken</span><span class="p">)</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="kt">var</span> <span class="n">tcs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TaskCompletionSource</span><span class="p">&lt;</span><span class="n">HttpResponseMessage</span><span class="p">&gt;();</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">tcs</span><span class="p">.</span><span class="n">SetResult</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="n">tcs</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can use this handler for injecting any response while you are unit
testing the code.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/10/binding-form-data-in-asp-net-web-api/">Binding Form Data in ASP.NET Web API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-10T00:00:00-03:00" pubdate data-updated="true">Aug 10<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/10/binding-form-data-in-asp-net-web-api/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One scenario that is very common in ASP.NET MVC is to bind form data
(data posted with the media type application/x-www-form-urlencoded)  to
individual parameters or a form collection in a controller action.
However, that scenario does not work quite the same in ASP.NET Web API
as the body content is treated a forward-only stream that can only be
read once. </p>

<p>If you define an action with multiple simple type arguments such as the
one shown bellow, the model binding runtime will try to map those by
default from the request URI (query string or route data). </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">Post</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That data never comes from the body content unless you decorate the
argument with the [FromBody] attribute. However, only one argument in
the action can be decorated with this attribute, and you get an
exception when you try to decorate more than one. Nevertheless, the
desired effect is far from what you would expect.</p>

<p>If you define an action as follow,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">Post</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And you POST a form with the following data,</p>

<p><a href="http://localhost:64561/api/values">http://localhost:64561/api/values</a></p>

<p>METHOD: POST</p>

<p>CONTENT-TYPE: application/x-www-form-urlencoded</p>

<p>BODY: id=4</p>

<p>Nothing will be mapped. It does not matter you defined a single
parameter with the same as the one posted in the body.</p>

<p>If you really want to have a single type argument mapped to the body
content, you have to POST a message with the following content</p>

<p><a href="http://localhost:64561/api/values">http://localhost:64561/api/values</a></p>

<p>METHOD: POST</p>

<p>CONTENT-TYPE: application/x-www-form-urlencoded</p>

<p>BODY: =4</p>

<p>As you can see, no key defined so the whole is mapped to our argument in
the action. That’s the default behavior for single types. If you want to
change that behavior, the framework is completely extensible and you can
replace the whole model binding infrastructure included out of the box
for one that you find more useful as it is explained
<a href="http://blogs.msdn.com/b/jmstall/archive/2012/04/18/mvc-style-parameter-binding-for-webapi.aspx">here</a>
by Mike Stalls (which shows how you can replicate the same model used by
ASP.NET MVC).</p>

<p>For complex types, the framework includes two MediaTypeFormatter
implementations. The first one is FormUrlEncodedMediaTypeFormatter,
which knows how to map every key/value in the form data to a
FormDataCollection or a JTokenType (a dynamic type for expressing JSON
available as part of the Json.NET library). These two are useful when
you want to get access to all the values in form in a generic manner.
You define for example a controller that receives a FormDataCollection
instance like this,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">Post</span><span class="p">(</span><span class="n">FormDataCollection</span> <span class="n">form</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The second one is JQueryMvcFormUrlEncodedFormatter, which derives from
the first one and knows how to map the form data to a concrete type
representing a model. For example, a model defined as follow will match
a body content with the keys “Id” and “Value”</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">MyModel</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>   <span class="k">public</span> <span class="kt">string</span> <span class="n">Value</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Therefore, your controller action can either receive a generic form
collection (or a JTokenType) or a complex model type as any of these two
will handle the deserialization of the body content type into the
expected model.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/09/implementing-synchronous-mediatypeformatters-in-asp-net-web-api/">Implementing Synchronous MediaTypeFormatters in ASP.NET Web API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-09T00:00:00-03:00" pubdate data-updated="true">Jul 9<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/09/implementing-synchronous-mediatypeformatters-in-asp-net-web-api/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of main characteristics of MediaTypeFormatter’s in ASP.NET Web API
is that they leverage the Task Parallel Library (TPL) for reading or
writing an model into an stream. When you derive your class from the
base class MediaTypeFormatter, you have to either implement the
WriteToStreamAsync or ReadFromStreamAsync methods for writing or reading
a model from a stream respectively.</p>

<p>These two methods return a Task, which internally does all the
serialization work, as it is illustrated bellow.</p>

<p><del> {.alt}
public abstract class MediaTypeFormatter
</del></p>

<pre><code>{
</code></pre>

<p><del> {.alt}
  public virtual Task WriteToStreamAsync(Type type, object value,
</del></p>

<pre><code>     Stream writeStream, HttpContent content, TransportContext transportContext);
</code></pre>

<p><del> {.alt}
  public virtual Task<object> ReadFromStreamAsync(Type type, Stream readStream,
</del></p>

<pre><code>     HttpContent content, IFormatterLogger formatterLogger);
</code></pre>

<p><del> {.alt}
}
</del></p>

<pre><code> 
</code></pre>

<p>However, most of the times, serialization is a safe operation that can
be done synchronously. In fact, many of the serializer classes you will
find in the .NET framework only provide sync methods. So the question
is, how you can transform that synchronous work into a Task ?.</p>

<p>Creating a new task using the method Task.Factory.StartNew for doing all
the serialization work would be probably the typical answer. That would
work, as a new task is going to be scheduled. However, that might
involve some unnecessary context switches, which are out of our control
and might be affect performance on server code specially.  </p>

<p>If you take a look at the source code of the MediaTypeFormatters shipped
as part of the framework, you will notice that they actually using
another pattern, which uses a TaskCompletionSource class.</p>

<p><del> {.alt}
public Task WriteToStreamAsync(Type type, object value, Stream writeStream,
</del></p>

<pre><code>HttpContent content, TransportContext transportContext)
</code></pre>

<p><del> {.alt}
{
</del></p>

<pre><code> 
</code></pre>

<p><del> {.alt}
  var tsc = new TaskCompletionSource<AsyncVoid>();
</del></p>

<pre><code>  tsc.SetResult(default(AsyncVoid));
</code></pre>

<p><del> {.alt}
 
</del></p>

<pre><code>  //Do all the serialization work here synchronously
</code></pre>

<p><del> {.alt}
 
</del></p>

<pre><code>  return tsc.Task;
</code></pre>

<p><del> {.alt}
}
</del></p>

<pre><code> 
</code></pre>

<p><del> {.alt}
/// <summary>
</del></p>

<pre><code>/// Used as the T in a "conversion" of a Task into a Task{T}
</code></pre>

<p><del> {.alt}
/// </summary>
</del></p>

<pre><code>private struct AsyncVoid
</code></pre>

<p><del> {.alt}
{
</del></p>

<pre><code>}
</code></pre>

<p>They are basically doing all the serialization work synchronously and
using a TaskCompletionSource for returning a task already done.</p>

<p>To conclude this post, this is another approach you might want to
consider when using serializers that are not compatible with an async
model.</p>

<p><strong>Update:</strong> Henrik Nielsen from the ASP.NET team pointed out the
existence of a built-in media type formatter for writing sync
formatters. BufferedMediaTypeFormatter
<a href="http://t.co/FxOfeI5x">http://t.co/FxOfeI5x</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/06/html-5-para-dispositivos-mobiles-proyecto-liike/">HTML 5 Para Dispositivos Mobiles – Proyecto Liike</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-06T00:00:00-03:00" pubdate data-updated="true">Jun 6<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/06/html-5-para-dispositivos-mobiles-proyecto-liike/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>La serie de videos que grabe con Miguel Angel Saenz y Ariel Schapiro de
Microsoft Argentina acerca del proyecto “Liike” de Patterns &amp; Practices
para desarrollos de aplicaciones mobiles con HTML 5 ha sido publicada en
channel9.</p>

<p>Les dejo la lista de videos para que los puedan ir viendo y conociendo
un poco mas con este proyecto mas que interesante.</p>

<p><a href="http://channel9.msdn.com/posts/1Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-1-introduccin">http://channel9.msdn.com/posts/1Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-1-introduccin</a>
\
<a href="http://channel9.msdn.com/posts/2Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-2-overview-de-aplicacin-Mileage-Stats">http://channel9.msdn.com/posts/2Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-2-overview-de-aplicacin-Mileage-Stats</a>
\
<a href="http://channel9.msdn.com/posts/3Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-3-determinacin-de-vista-en-html-a-mostrar">http://channel9.msdn.com/posts/3Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-3-determinacin-de-vista-en-html-a-mostrar</a>
\
<a href="http://channel9.msdn.com/posts/4Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-4-Single-Page-application">http://channel9.msdn.com/posts/4Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-4-Single-Page-application</a>
\
<a href="http://channel9.msdn.com/posts/5Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-5-nuevos-controles-HTML5">http://channel9.msdn.com/posts/5Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-5-nuevos-controles-HTML5</a>&ndash;
\
<a href="http://channel9.msdn.com/posts/6Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-6-Botn-Switch-to-Desktop-Site">http://channel9.msdn.com/posts/6Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-6-Botn-Switch-to-Desktop-Site</a>
\
<a href="http://channel9.msdn.com/posts/7Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-7-Testing-de-aplicaciones-mviles-en-HTML5">http://channel9.msdn.com/posts/7Serie-HTML5-para-dispositivos-mviles-Proyecto-Liike-parte-7-Testing-de-aplicaciones-mviles-en-HTML5</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/11/apache-cordova-a-new-alternative-for-developing-native-apps-in-win-phone-7/">Apache Cordova. A New Alternative for Developing Native Apps in Win Phone 7</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-11T00:00:00-03:00" pubdate data-updated="true">May 11<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/05/11/apache-cordova-a-new-alternative-for-developing-native-apps-in-win-phone-7/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://incubator.apache.org/cordova/">Apache Cordova</a> is one of those
projects that recently caught my attention for developing applications
in mobile. This project previously known as PhoneGap was donated by
Adobe to the Apache Foundation to be part of a new and attractive open
source alternative for developing mobile applications.  If you haven’t
heard of it before, it basically provides the required infrastructure to
run native applications in different mobile platforms such as IOS,
Android, and Windows Phone 7 using an hybrid approach with an embedded
browser. There is a thin native layer that provides access to different
native features in phone through an standard object model in JavaScript,
so the developers can write their applications using HTML 5 and have
access to different features through that model. Therefore, the two most
important components in this project are the native layer and the
JavaScript component model, which are supported across the different
platforms.</p>

<p>The Microsoft Interoperability team collaborated as part of the project
to support Win7 phone as another available platform, which <a href="http://blogs.msdn.com/b/interoperability/archive/2011/12/16/full-support-for-phonegap-on-windows-phone-is-now-complete.aspx">was
announced by Abu
Obeida</a>
in December last year. Another major announcement these days was the
support for a <a href="http://blogs.msdn.com/b/interoperability/archive/2012/04/26/more-news-from-ms-open-tech-announcing-the-open-source-metro-style-theme.aspx">Metro theme in JQuery
Mobile</a>,
which gives the ability to give applications written in HTML 5 for this
platform the same look and feel as a native applications.</p>

<p>If you want to know more about the platform, there is an excellent
introductory article written by Colin Eberhardt for the MSDN Magazine,
<a href="http://msdn.microsoft.com/en-us/magazine/hh975345.aspx">“Develop HTML Windows Phone Apps with Apache
Cordova”</a></p>

<p>One the things I noticed in the project, is that there is available a
project template in Visual Studio for creating the initial application.
However, you need to manually deploy that template in the right folder
to make it available in Visual Studio, which might be an error prone
task. I decided to make a little contribution to the project and write
an Visual Studio extension (a vsix package) to automatically deploy the
template, which I am not sure yet if it is going to be approved or not,
but I think it is a nice thing to have for easing adoption. This is part
of the <a href="https://github.com/pcibraro/incubator-cordova-wp7">fork associated to my
user</a> in case you
want to use it.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/10/20/do-not-version-urls/">Do Not Version Urls</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/23/selfhost-utilities/">SelfHost Utilities</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/23/appfabric-outputcaching/">AppFabric OutputCaching</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/31/making-ajax-calls-with-hawk-authentication-to-asp-dot-net-web-api/">Making Ajax Calls With Hawk Authentication to ASP.NET Web API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/13/coordinating-async-work-in-node-dot-js/">Coordinating Async Work in Node.js</a>
      </li>
    
  </ul>
</section>
 <a href="http://feeds.feedburner.com/cibrax"><img src="http://feeds.feedburner.com/~fc/cibrax?bg=FF3300&amp;fg=000000&amp;anim=0" style="border:0" alt="" /></a>

 <script type="text/javascript" language="javascript" src="http://twittercounter.com/embed/?username=cibrax&style=white"></script>
<a href="https://mvp.microsoft.com/en-us/mvp/Pablo%20Cibraro-33800"><img src="/images/mvp.gif" border="0" /></a>
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/pcibraro">@pcibraro</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pcibraro',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Cibrax -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'cibrax';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
