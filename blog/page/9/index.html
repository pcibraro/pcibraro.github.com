
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pablo Cibraro (Cibrax)</title>
  <meta name="author" content="Cibrax">

  
  <meta name="description" content="One of the common problems that you might find when using the generated
DataServiceContext for consuming an existing WCF data service is that
you &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cibrax.me/blog/page/9">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/cibrax" rel="alternate" title="Pablo Cibraro (Cibrax)" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44468149-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Pablo Cibraro (Cibrax)</a></h1>
  
    <h2>All about software development.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/cibrax" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:cibrax.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/categories">Categories</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/27/getting-rid-of-the-magic-strings-in-a-wcf-data-service-client/">Getting Rid of the Magic Strings in a WCF Data Service Client</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-27T00:00:00-03:00" pubdate data-updated="true">Oct 27<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/10/27/getting-rid-of-the-magic-strings-in-a-wcf-data-service-client/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the common problems that you might find when using the generated
DataServiceContext for consuming an existing WCF data service is that
you have magic strings everywhere for handling links (expanding, adding,
deleting, etc). The problem with all those magic strings is that they
make your code to compile correctly, but you might run into some error
at runtime because you used a link that does not exist or it was just
renamed.</p>

<p>To give an example, this is how you expand the items associated to an
order using the traditional way with magic strings.</p>

<p>context.Orders.Expand(“Items”)</p>

<p>If that property is later renamed to “OrderItems” on the service side,
and the proxy is updated, that code will still compile but you will
receive an error at runtime.</p>

<p>Fortunately, you can get rid of those “magic” strings and making the
compiler your friend by leveraging Expression trees. The expression
trees will make your code easier to maintain, and what’s more important,
the compiler will verify the expressions correctness at compilation
time.</p>

<p>Continuing what <a href="http://blogs.msdn.com/b/stuartleeks/archive/2008/09/15/dataservicequery-t-expand.aspx">Stuart
Leeks</a>
did for link expansions with expressions, I added a few more methods for
managing links. </p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
namespace System.Data.Services.Client
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
{
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>public static class DataServiceExtensions
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>{
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    public static void SetLink&lt;TSource, TPropType&gt;(this DataServiceContext context, TSource source, 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        Expression&lt;Func&lt;TSource, TPropType&gt;&gt; propertySelector, object target)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        string expandString = BuildString(propertySelector);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        context.SetLink(source, expandString, target);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    public static void AddLink&lt;TSource, TPropType&gt;(this DataServiceContext context, 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        TSource source, Expression&lt;Func&lt;TSource, TPropType&gt;&gt; propertySelector, object target)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        string expandString = BuildString(propertySelector);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        context.AddLink(source, expandString, target);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    public static void DeleteLink&lt;TSource, TPropType&gt;(this DataServiceContext context, 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        TSource source, Expression&lt;Func&lt;TSource, TPropType&gt;&gt; propertySelector, object target)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        string expandString = BuildString(propertySelector);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        context.DeleteLink(source, expandString, target);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    public static void LoadProperty&lt;TSource, TPropType&gt;(this DataServiceContext context, 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        TSource source, Expression&lt;Func&lt;TSource, TPropType&gt;&gt; propertySelector)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        string expandString = BuildString(propertySelector);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        context.LoadProperty(source, expandString);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    public static DataServiceQuery&lt;TSource&gt; Expand&lt;TSource, TPropType&gt;(this DataServiceQuery&lt;TSource&gt; source, 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        Expression&lt;Func&lt;TSource, TPropType&gt;&gt; propertySelector)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        string expandString = BuildString(propertySelector);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        return source.Expand(expandString);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    private static string BuildString(Expression propertySelector)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        switch (propertySelector.NodeType)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>            case ExpressionType.Lambda:
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                LambdaExpression lambdaExpression = (LambdaExpression)propertySelector;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                return BuildString(lambdaExpression.Body);
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>            case ExpressionType.Quote:
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                UnaryExpression unaryExpression = (UnaryExpression)propertySelector;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                return BuildString(unaryExpression.Operand);
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>            case ExpressionType.MemberAccess:
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                MemberInfo propertyInfo = ((MemberExpression)propertySelector).Member;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                return propertyInfo.Name;
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>            case ExpressionType.Call:
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                MethodCallExpression methodCallExpression = (MethodCallExpression)propertySelector;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                if (IsSubExpand(methodCallExpression.Method)) // check that it's a SubExpand call
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                    // argument 0 is the expression to which the SubExpand is applied (this could be member access or another SubExpand)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                    // argument 1 is the expression to apply to get the expanded property
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                    // Pass both to BuildString to get the full expression
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                    return BuildString(methodCallExpression.Arguments[0]) + "/" +
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                           BuildString(methodCallExpression.Arguments[1]);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                }
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                // else drop out and throw
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                break;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        }
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        throw new InvalidOperationException("Expression must be a member expression or an SubExpand call: " + propertySelector.ToString());
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    private static readonly MethodInfo[] SubExpandMethods;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    static DataServiceExtensions()
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        Type type = typeof(DataServiceExtensions);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        SubExpandMethods = type.GetMethods().Where(mi =&gt; mi.Name == "SubExpand").ToArray();
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    private static bool IsSubExpand(MethodInfo methodInfo)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        if (methodInfo.IsGenericMethod)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>            if (!methodInfo.IsGenericMethodDefinition)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>            {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>                methodInfo = methodInfo.GetGenericMethodDefinition();
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>            }
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        }
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        return SubExpandMethods.Contains(methodInfo);
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    public static TPropType SubExpand&lt;TSource, TPropType&gt;(this Collection&lt;TSource&gt; source, Expression&lt;Func&lt;TSource, TPropType&gt;&gt; propertySelector)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        where TSource : class
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        where TPropType : class
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        throw new InvalidOperationException("This method is only intended for use with DataServiceQueryExtensions.Expand"); 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    public static TPropType SubExpand&lt;TSource, TPropType&gt;(this TSource source, Expression&lt;Func&lt;TSource, TPropType&gt;&gt; propertySelector)
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        where TSource : class
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        where TPropType : class
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    {
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>        throw new InvalidOperationException("This method is only intended for use with DataServiceQueryExtensions.Expand"); 
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>    }
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>}
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
}
</del></p>

<p>With all these extensions in place you can do the following things,</p>

<p>​1. Expanding a collection</p>

<p>context.Orders.Expand(o => o.Items)</p>

<p>​2. Expanding a collection and subcollection</p>

<p>context.Orders.Expand(o => o.Items.SubExpand(i => i.Product))</p>

<p>​3. Adding a link</p>

<p>context.AddLink(order, o => o.Items, item)</p>

<p>​4. Removing a link</p>

<p>context.DeleteLink(order, o => o.Items, item)</p>

<p>​5. Loading an association</p>

<p>context.LoadProperty(order, o => o.Items)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/21/security-identity-propagation-for-wcf-ajax-endpoints-in-asp-net/">Security Identity Propagation for WCF Ajax Endpoints in ASP.NET</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-21T00:00:00-03:00" pubdate data-updated="true">Oct 21<span>st</span>, 2010</time>
        
         | <a href="/blog/2010/10/21/security-identity-propagation-for-wcf-ajax-endpoints-in-asp-net/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A UI driven service is usually a service implementation that only makes
sense in the context of the UI for solving an specific use case, and not
something that you might want to share or expose to third parties.
Typical examples of UI driven services are AJAX endpoints, which you
build for supporting partial updates in a page. The implementation of
this kind of services can take the form of a simple http endpoints,
which could adhere to the REST principles or not, or SOAP web
services.   </p>

<p>As the AJAX endpoints are consumed by the web browser on behalf of the
user, you will typically want to propagate the web browser security
context to this service, and not a new one, so the web pages and the
services both run under the same user identity.</p>

<p>If the web pages and the services are both running in the same hosting
stack like ASP.NET, this does not represent a problem at all, as they
both share the security context of the host. For example, if you
implement the services as ASMX web services, or Http Handlers, or MVC
controller actions, they will all share the ASP.NET security context
with the pages.</p>

<p>WCF runs by default in its own hosting space, which is not dependant of
ASP.NET, so here is where the problem begins. Message security is
obviously discarded for this scenario, as a client script does not know
how to handle cryptographic material for doing all the message signing
and encryption. In addition, it would add some unnecessary complexity to
the solution, which is not need for the scenarios that an AJAX endpoint
tries to achieve. Therefore, transport security is the right choice for
WCF Ajax endpoints if you want to encrypt the traffic with SSL, and none
if the information does not need to be encrypted because it is not
sensitive. In both cases, the right choice for a binding is
“basicHttpBinding” for SOAP services and “webHttpBinding” for any other
Http endpoint that does not use soap envelopes.</p>

<p>For example, the following binding configures a SOAP service with
“basicHttpBinding” and no security.</p>

<p>&lt;basicHttpBinding> \
        &lt;binding name=&ldquo;AjaxEndpoints&rdquo;> \
          &lt;security mode=&ldquo;None&rdquo;>&lt;/security> \
        &lt;/binding> \
&lt;/basicHttpBinding></p>

<p>In addition, as you want to propagate the user identity from ASP.NET to
the WCF services. You need to enable the ASP.NET compatibility mode in
the service, so ASP.NET and the WCF Ajax services both share the same
user identity, no matter which security mechanism was configured in
ASP.NET (forms, claims, or any http authentication mechanism).</p>

<p>For enabling the ASP.NET compatibility mode, you have to add the
following configuration to the serviceModel section,</p>

<p><del> {#codeSnippet style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
&lt;system.serviceModel>    <serviceHostingEnvironment aspNetCompatibilityEnabled="true"/>
</del></p>

<p>\
And decorate your service with the AspNetCompatibilityRequirements
attribute,</p>

<p><del> {#codeSnippet style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
[AspNetCompatibilityRequirements(RequirementsMode=AspNetCompatibilityRequirementsMode.Allowed)]public class Service1 : IService1
</del></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/14/so-aware-integration-with-visual-studio-2008/">SO-Aware Integration With Visual Studio 2008</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-14T00:00:00-03:00" pubdate data-updated="true">Oct 14<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/10/14/so-aware-integration-with-visual-studio-2008/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I am happy to announce today the support in Visual Studio 2008 for
adding new service references from the SO-Aware service repository. We
have created a simple plugin that you can register in Visual Studio to
support this new functionality.</p>

<p>The functionality provided by this plugin is equivalent to what you
already have for Visual Studio 2010. A new option is added to the
project context menu “Add Service Reference From SO-Aware”, which is
almost similar to the classic “Add Service Reference” option with the
difference that you can look for existing services in the repository and
the generated proxy derives from ConfigurableClientBase&lt;T> rather than
ClientBase&lt;T></p>

<p><img src="http://weblogs.asp.net/blogs/cibrax/AddServiceReference_0B890770.png" title="AddServiceReference" alt="AddServiceReference" /></p>

<p>Once you clicked in that option, a new screen will appear to select one
of the existing services in the repository.</p>

<p><img src="http://weblogs.asp.net/blogs/cibrax/Repository_0F46AC40.png" title="Repository" alt="Repository" /></p>

<p>The generated proxy will have methods to consume the service operation
as any regular service proxy, but also two methods that are specific to
WCF for optionally configuring a client behavior (SetClientBehavior) or
a binding (SetDefaultBinding) from the repository. These are optional as
otherwise, the behaviors and bindings configured for the service in the
repository will be used.</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
CustomersClient client = new CustomersClient();
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
client.SetClientBehavior(&ldquo;BehaviorName&rdquo;);
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
client.SetDefaultBinding(&ldquo;BindingName&rdquo;);
</del></p>

<p>Those methods receive an string with the name of the behavior or binding
you want to resolve from the repository, so there is no need to have the
“serviceModel” configuration section anymore :).</p>

<p>This new plugin is available as part of the SO-Aware SDK that you can
get from
<a href="http://www.tellagostudios.com/resources/so-aware-sdk-samples-and-utilities">here</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/08/asp-net-mvc-wcf-rest-and-data-services-when-to-use-what-for-restful-services/">ASP.NET MVC, WCF REST and Data Services – When to Use What for RESTful Services</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-08T00:00:00-03:00" pubdate data-updated="true">Oct 8<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/10/08/asp-net-mvc-wcf-rest-and-data-services-when-to-use-what-for-restful-services/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Disclaimer: This post only contains personal opinions about this
subject</em></p>

<p>In the way I see it, REST mainly comes in for two scenarios, when you
need to expose some AJAX endpoints for your web application or when you
need to expose an API to external applications through well defined
services.  </p>

<p>For AJAX endpoints, the scenario is clear, you want to expose some data
for being consumed by different web pages with client scripts. At this
point, what you expose is either HTML, text, plain XML, or JSON, which
is the most common, compact and efficient format for dealing with data
in javascript. Different client libraries like JQuery or MooTools
already come with built-in support for JSON. This data is not intended
for being consumed by other clients rather than the pages running in the
same web domain. In fact, some companies add custom logic in these
endpoints for responding only to requests originated in the same domain.</p>

<p>For RESTful services, the scenario is completely different, you want to
expose data or business logic to many different client applications
through a well know API. Good examples of REST services are twitter, the
Windows Azure storage services or the Amazon S3 services to name a few.</p>

<p>Smart client applications implemented with Silverlight, Flex or Adobe
Air also represent client applications that can be included in this
category with some restrictions, as they can not make cross domain call
to http services by default unless you override the cross-domain
policies.   </p>

<p>A common misconception is to think that REST services only mean CRUD for
data, which is one of the most common scenarios, but business workflows
can also be exposed through this kind of service as it is shown in this
article <a href="http://www.infoq.com/articles/webber-rest-workflow">“How to get a cup of
coffe”</a></p>

<p>When it comes to the .NET world, you have three options for implementing
REST services (I am not considering third party framework or OS projects
in this post),</p>

<ol>
<li>ASP.NET MVC</li>
<li>WCF REST</li>
<li>WCF Data Services (OData)</li>
</ol>


<h2>ASP.NET MVC</h2>

<p>This framework represents the implementation of the popular
model-view-controller (MVC) pattern for building web applications in the
.NET space. The reason for moving traditional web application
development toward this pattern is to produce more testable components
by having a clean separation of concerns. The three components in this
architecture are the model, which only represents data that is shared
between the view and the controller, the view, which knows how to render
output results for different web agents (i.e. a web browser), and
finally the controller, which coordinates the execution of an use case
and the place where all the main logic associated to the application
lives on. Testing ASP.NET Forms applications was pretty hard, as the
implementation of a page usually mixed business logic with rendering
details, the view and the controller were tied together, and therefore
you did not have a way to focus testing efforts on the business logic
only. You could prepare your asp.net forms application to use MVC or MVP
(Model-View-Presenter) patterns to have all that logic separated, but
the framework itself did not enforce that.</p>

<p>On the other hand, in ASP.NET MVC, the framework itself drives the
design of the web application to follow an MVC pattern. Although it is
not common, developers can still make terrible mistakes by putting
business logic in the views, but in general, the main logic for the
application will be in the controllers, and those are the ones you will
want to test.</p>

<p>In addition, controllers are TDD friendly, and the ASP.NET MVC team has
made a great work by making sure that all the ASP.NET intrinsic objects
like the Http Context, Sessions, Request or Response can be mocked in an
unit test.</p>

<p>While this framework represents a great addition for building web
applications on top of ASP.NET, the API or some components in the
framework (like view engines) not necessarily make a lot of sense when
building stand alone services. I am not saying that you could not build
REST services with ASP.NET MVC, but you will have to leverage some of
the framework extensibility points to support some of the scenarios you
might want to use with this kind of services.</p>

<p>Content negotiation is a good example of an scenario not supported by
default in the framework, but something you can implement on your own
using some of the available extensions. For example, if you do not want
to tie your controller method implementation to an specific content
type, you should return an specific ActionResult implementation that
would know how to handle and serialize the response in all the supported
content types. Same thing for request messages, you might need to
implement model binders for mapping different content types to the
objects actually expected by the controller.</p>

<p>The public API for the controller also exposes methods that are more
oriented to build web applications rather than services. For instance,
you have methods for rendering javascript content, or for storing
temporary data for the views.</p>

<p>If you are already developing a website with ASP.NET MVC, and you need
to expose some AJAX endpoints (which actually represents UI driven
services) for being consumed in the views, probably the best thing you
can do is to implement them with MVC too as operations in the
controller. It does not make sense at this point to bring WCF to
implement those, as it would only complicate the overall architecture of
the application. WCF would only make sense if you need to implement some
business driven services that need to be consumed by your MVC
application and some other possible clients applications as well.</p>

<p>This framework also introduced a new routing mechanism for mapping URLs
to controller actions in ASP.NET, making possible to have friendly and
nice URLS for exposing the different resources in the API.</p>

<p>As this framework is layered on top of ASP.NET, one thing you might find
complicated to implement is security. Security in ASP.NET is commonly
tied to a web application, so it is hard to support schemes where you
need different authentication mechanisms for your services. For example,
if you have basic authentication enabled for the web application hosting
the services, it would be complicated to support other authentication
mechanism like OAuth. You can  develop custom modules for handling these
scenarios, but that is something else you need to implement.   </p>

<h2>WCF REST</h2>

<p>The WCF Web Http programming model was first introduced as part of the
.NET framework 3.5 SP1 for building non-SOAP http services that might
follow or not the different REST architectural constraint. This new
model brought to the scene some new capabilities for WCF by adding new
attributes in the service model ([WebGet] and [WebInvoke]) for routing
messages to service operations through URIs and Http methods, behaviors
for doing same basic content negotiation and exception handling, a new
WebOperationContext static object for getting access and controlling
different http header and messages, and finally a new binding
WebHttpBinding for handling some underline details related to the http
protocol.</p>

<p>The WCF team later released an REST starter kit in codeplex with new
features on top of this web programming model to help developers to
produce more RESTful services. This starter kit also included a
combination of examples and Visual Studio templates for showing how some
of the REST constraints could be implemented in WCF, and also a couple
of interesting features to support help pages, output caching,
intercepting request messages and a very useful Http client library for
consuming existing services (HttpClient)</p>

<p>Many of those features were finally included in the latest WCF release,
4.0, and also the ability of routing messages to the services with
friendly URLs using the same ASP.NET routing mechanism that ASP.NET MVC
uses.</p>

<p>As services are first citizens in WCF, you have exclusive control over
security, message size quotas and throttling for every individual
services and not for all services running in a host as it would happen
with ASP.NET.  In addition, WCF provides its own hosting infrastructure,
which is not dependant of ASP.NET so it is possible to self hosting
services in any regular .NET application like a windows service for
example.</p>

<p>In the case of hosting services in ASP.NET with IIS, previous versions
of WCF (3.0 and 3.5) relied on a file with “svc” extension to activate
the service host when a new message arrived. WCF 4.0 now supports
file-less activation for services hosted in ASP.NET, which relies on a
configuration setting, and also a mechanism based on Http routing
equivalent to what ASP.NET MVC provides, making possible to support
friendly URLs. However, there is an slight difference in the way this
last one works compared to ASP.NET MVC. In ASP.NET MVC, a route
specifies the controller and also the operation or method that should
handle a message. In WCF, the route is associated to a factory that
knows how to create new instances of the service host associated to the
service, and URI templates attached to [WebGet] and [WebInkoke]
attributes in the operations take care of the final routing. This
approach works much better in the way I see it, as you can create an URI
schema more oriented to resources, and route messages based on Http
Verbs as well without needing to redefine additional routes. </p>

<p>The support for doing TDD at this point is somehow limited fore the fact
that services rely on the static context class for getting and setting
http headers, making very difficult to initialize that one in a test or
mock it for setting some expectations.</p>

<p>The content negotiation story was improved in WCF 4.0, but it still
needs some twists to make it complete as you might need to extend the
default WebContentTypeMapper class for supporting custom media types
other than the standard “application/xml” for xml and “application/json”
for JSON.</p>

<p>The WCF team is seriously considering to improve these last two aspects
and adding some other capabilities to the stack for a next version.</p>

<h2>WCF Data Services</h2>

<p>WCF Data Services, formerly called ADO.NET Data Services, was introduced
in the .NET stack as way of making any IQueryable data source public to
the world through a REST API. Although a WCF Data Service sits on top of
the WCF Web programming model, and therefore is a regular WCF service, I
wanted to make a distinction here for the fact that this kind of service
exposes metadata for the consumers, and also adds some restrictions for
the URIs and the types that can be exposed in the service. All these
features and restrictions have been documented and published as a
separate specification known as OData. </p>

<p>The framework includes a set of providers or extensibility points that
you can customize to make your model writable, extend the available
metadata, intercepting messages or supporting different paging and
querying schemas. </p>

<p>A WCF Data Service basically uses URI segments as mechanism for
expressing queries that can be translated to an underline linq provider,
making possible to execute the queries on the data source itself, and
not something that happens in memory. The result of executing those
queries is what finally got returned as response from the service.
Therefore, WCF Data services use URI segments to express many of
supported linq operators, and the entities that need to be retrieved.
This capability of course is what limit the URI space that you can use
on your service, as any URI that does not follow the OData standard will
result in an error.</p>

<p>Content negotiation is also limited to two media types, JSON and Xml
Atom, and the content payload itself is restricted to specific types
that you can find as part of the OData specification.</p>

<p>Besides of those two limitations, WCF Data Service is still extremely
useful for exposing a complete data set with query capabilities through
a REST interface with just a few lines of code. JSON and Atom are two
very accepted formats nowadays, making this technology very appealing
for exposing data that can easily be consumed by any existing client
platform, and even web browsers.</p>

<p>Also, for Web applications with ajax and smart client applications, you
do not need to reinvent the wheel and create a complete set of services
for just exposing data with a CRUD interface. You get your existing data
model, configure some views or filters for the data you want to expose
in the model in the data service itself, and that is all.          </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/28/the-swift-knife-for-managing-x509-certificates-in-windows/">The Swiss Knife for Managing X509 Certificates in Windows</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-28T00:00:00-03:00" pubdate data-updated="true">Sep 28<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/09/28/the-swift-knife-for-managing-x509-certificates-in-windows/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.iamraf.net">Raffaele Rialdi</a>, a security MVP from Italy, has
just released a very cool
<a href="http://www.iamraf.net/Tools/DeployManager-first-release-certificates-management">tool</a>
to manage X509 certificates in windows. X509 certificates has always
represent a pain for most developers, as they are hard to deploy or
configure correctly with the right permissions. A tool like this is
absolutely need when working with frameworks like WCF or WIF that makes
an extensive use of certificates.</p>

<p>These are some of the features that you can find in this initial
version,</p>

<ol>
<li>Ability to create self-signed certificates from the UI by specifying
all the different settings that you need (certificate name,
expiration dates, password, certificate store).</li>
<li>Ability to browse the different certificate stores and do things
like checking the certificate details, the chain trust for an
specific certificate, or change its ACL permissions.</li>
</ol>


<p>You will able to find more details about the tool
<a href="http://www.iamraf.net/Tools/DeployManager-first-release-certificates-management">here</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/17/exposing-additional-service-metadata-with-ws-discovery-in-wcf-4-0/">Exposing Additional Service Metadata With WS-Discovery in WCF 4.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-17T00:00:00-03:00" pubdate data-updated="true">Sep 17<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/09/17/exposing-additional-service-metadata-with-ws-discovery-in-wcf-4-0/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>WS-Discovery is not only a mechanism for discovering service endpoint
addresses at runtime, but also a way to query for specific service
information and metadata. If you look at it from another standpoint,
WS-Discovery provides access to a decentralized short-lived service
catalog that is available as long as the services are running. It is
decentralized because every service expose their own metadata, unless
you use a WS-Discovery managed proxy, which act as an intermediary and
central location for service discovery. It is short-lived because it is
only available when the service is running, and it is not something that
clients could use at any time.</p>

<p>With all this, I am not saying that WS-Discovery is a good replacement
for a service repository, which actually provides opposite capabilities,
a centralized storage for service metadata at design time that supports
full rich querying.</p>

<p>However, they both complement very well each, the service can configure
itself from the service repository, and expose metadata and runtime
information to clients through WS-Discovery.</p>

<p>There are two types of metadata attributes or extensions that you can
configure in the “endpoint” discovery behavior,</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
<endpointDiscovery enabled="true">
</del></p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>&lt;scopes&gt;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>  &lt;add scope="urn:CRM"/&gt;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>&lt;/scopes&gt;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>&lt;extensions&gt;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>  &lt;Owner&gt;Pablo Cibraro&lt;/Owner&gt;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>  &lt;Metadata&gt;http://locahost:8080/?wsdl&lt;/Metadata&gt;
</code></pre>

<p>~~~~</p>

<p>~~~~ {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}</p>

<pre><code>&lt;/extensions&gt;
</code></pre>

<p>~~~~</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
</endpointDiscovery>
</del></p>

<p>Scopes, which represents “URI”s and can be used by clients to filter the
discovery results when sending the discovery probes. For example, in the
configuration above, a client could only be interested in a service that
provides a “urn:CRM” scope, so this service will match that probe.</p>

<p>On the client side, the WCF client can specify the “scopes” as part of
the “FindCriteria” argument passed to the DiscoveryClient,</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
var discovery = new DiscoveryClient(new UdpDiscoveryEndpoint());
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
var criteria = new FindCriteria(typeof(IHelloWorld));
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
criteria.Scopes.Add(new Uri(&ldquo;urn:CRM&rdquo;));
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
var discoveryResponse = discovery.Find(criteria);
</del></p>

<p>Then, you have “extensions”, which are xml elements that provide
additional information about the service. In the given example, the
extensions are used to provide information about the service owner (the
developer), and the service metadata endpoint, but you could extend this
to any service metadata or documentation.  </p>

<p>The service metadata endpoint (or MEX endpoint in WCF) is useful here as
part of the extensions because WS-Discovery only returns the &ldquo;service”
endpoint address as part of the response for the probe messages.</p>

<p>The extensions are available on the client side as part of the discovery
response message in the found endpoints.</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
var discovery = new DiscoveryClient(new UdpDiscoveryEndpoint());
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
var criteria = new FindCriteria(typeof(IHelloWorld));
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
var discoveryResponse = discovery.Find(criteria);
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
var address = discoveryResponse.Endpoints.First().Address;
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
Console.WriteLine(discoveryResponse.Endpoints.First().Extensions);
</del></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/15/swutil-a-new-tool-for-generating-service-proxies-from-the-so-aware-repository/">SWUtil - a New Tool for Generating Service Proxies From the SO-Aware Repository.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-15T00:00:00-03:00" pubdate data-updated="true">Sep 15<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/09/15/swutil-a-new-tool-for-generating-service-proxies-from-the-so-aware-repository/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As we announced last week, we are shipping a new Visual Studio plugin
for generating service proxies as part of the SO-Aware SDK. The
functionality is equivalent to what you find today in the “Add Service
Reference” command, but the results are much better as you get a proxy
that does not require any WCF configuration, and also knows how to
resolve bindings and behaviors from the repository.</p>

<p>However, that plugin is only available for Visual Studio 2010, meaning
that you need an alternative solution for generating the same equivalent
proxy if you are using older versions of Visual Studio or you are not
even using this development environment. Here is where “swutil.exe”
comes to fill that gap.</p>

<p>This tool is equivalent to “svcutil.exe”, the one that comes with the
.NET framework for generating WCF service proxies, but the result is a
much more intelligent proxy that does not require any previous knowledge
of WCF configuration.</p>

<p>The following arguments are supported by this new tool,</p>

<p>swutil.exe -help</p>

<p>Parameters:</p>

<p>-help           Prints the help screen. \
-uri             Service Repository Uri \
-version       Service Version Name \
-category    Configuration Category \
-out            Output file \
-language    Language: cs or vb \
-serializer    xml or datacontract</p>

<p>The generated proxy derives from a specific SO-Aware base class
“ConfigurableClientBase&lt;T>”, and not the traditional one
“ClientBase&lt;T>” that you find in the WCF.</p>

<p>This specific base class gives you access to some methods like
“SetClientBehavior” or “SetDefaultBinding” that become handy for
automatically resolving bindings and behavior configuration from the
repository.</p>

<p>Those methods receive an string with the “binding” or “behavior” name,
and automatically inject the equivalent WCF object into the WCF channel
after having resolved that name in the repository.</p>

<p>The following lines illustrate how you would use this new proxy to
consume a service.</p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
EchoClaimsClient proxy = new EchoClaimsClient(ServiceUri, &ldquo;EchoClaims(1.0)&rdquo;, null, &ldquo;CustomBinding_IEchoClaims&rdquo;);
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
proxy.SetClientBehavior(&ldquo;echoClaimsEndpointBehavior&rdquo;);
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
proxy.SetDefaultBinding(&ldquo;echoClaims_MutualCertificate&rdquo;);
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
 
</del></p>

<p><del> {style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
var response = proxy.Echo();
</del></p>

<p>That’s all, no configuration is required on the client side for
consuming the service. All the magic happens in that proxy class :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/06/why-asmx-web-services-are-not-an-excuse-anymore-with-wcf-4-0/">Why ASMX Web Services Are Not an Excuse Anymore With WCF 4.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-06T00:00:00-03:00" pubdate data-updated="true">Sep 6<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/09/06/why-asmx-web-services-are-not-an-excuse-anymore-with-wcf-4-0/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ASXM web services has been the favorite choice for many developers for
building soap web services in .NET during a long time because of its
simplicity. With ASMX web services, you get a web service up and running
in a matter of seconds, as it does not require any configuration. The
only thing you need to do is to build the service implementation and the
message contracts (xml serialization classes), and that’s all. However,
when you build a system as a black box with most of the configuration
hardcoded, and only a few extensibility points in mind, you will
probably end up with something that is very easy to deploy and get
running, but it can not be customized at all. That’s what an ASMX web
service is after all, you don’t have a way easily change the protocol
versions, encoders, security or even extend with custom functionality
(SOAP extensions are the only entry point for extensibility, which work
as message inspectors in WCF).</p>

<p>On the other hand, you have WCF, which is extensible beast for building
services among other things. The number of extensibility points that you
will find in WCF is extremely high, but the downside is that
configuration also becomes extremely complex and a nightmare for most
developers that only want to get their services up and running.</p>

<p>Fortunately, the WCF team has considerably improved the configuration
experience in WCF 4.0, making possible to run a service with almost no
configuration. The approach that they have taken for this version is to
make everything work with no configuration, and give the chance to
override what you actually need for a given scenario.</p>

<p>For instance, a WCF service that uses http as transport behaves a ASMX
web service by default (it uses basicHttpBinding with SOAP 1.2,
transport security, text encoding and Basic profile 1.1) unless you
change that. So, how can you create a new WCF service as you did before
with ASMX ?. That’s simple and you need to follow these steps,</p>

<p>​1. Create a new WCF service in Visual Studio</p>

<p><a href="http://weblogs.asp.net/blogs/cibrax/visualstudio_newservice_47C62622.png"><img src="http://weblogs.asp.net/blogs/cibrax/visualstudio_newservice_thumb_38629E46.png" title="visualstudio_newservice" alt="visualstudio_newservice" /></a></p>

<p>​2. Modify the service and data contract to expose the operations you
actually need in the service.</p>

<p> </p>

<p><del> {#codeSnippet style=&ldquo;BORDER-BOTTOM-STYLE: none; TEXT-ALIGN: left; PADDING-BOTTOM: 0px; LINE-HEIGHT: 12pt; BORDER-RIGHT-STYLE: none; BACKGROUND-COLOR: #f4f4f4; MARGIN: 0em; PADDING-LEFT: 0px; WIDTH: 100%; PADDING-RIGHT: 0px; FONT-FAMILY: &lsquo;Courier New&rsquo;, courier, monospace; DIRECTION: ltr; BORDER-TOP-STYLE: none; COLOR: black; FONT-SIZE: 8pt; BORDER-LEFT-STYLE: none; OVERFLOW: visible; PADDING-TOP: 0px&rdquo;}
// NOTE: You can use the &ldquo;Rename&rdquo; command on the &ldquo;Refactor&rdquo; menu to change the interface name &ldquo;IService1&rdquo; in both code and config file together.[ServiceContract]public interface IService1{    [OperationContract]    string GetData(int value);    [OperationContract]    CompositeType GetDataUsingDataContract(CompositeType composite);    // TODO: Add your service operations here}// Use a data contract as illustrated in the sample below to add composite types to service operations.[DataContract]public class CompositeType{    bool boolValue = true;    string stringValue = &ldquo;Hello &rdquo;;    [DataMember]    public bool BoolValue    {        get { return boolValue; }        set { boolValue = value; }    }    [DataMember]    public string StringValue    {        get { return stringValue; }        set { stringValue = value; }    }}
</del></p>

<p>\</p>

<p>​3. Optionally, enable the service metadata page for the service, so any
client application can use this to generate the proxies.</p>

<p><del> {#codeSnippet style=&ldquo;BORDER-BOTTOM-STYLE: none; TEXT-ALIGN: left; PADDING-BOTTOM: 0px; LINE-HEIGHT: 12pt; BORDER-RIGHT-STYLE: none; BACKGROUND-COLOR: #f4f4f4; MARGIN: 0em; PADDING-LEFT: 0px; WIDTH: 100%; PADDING-RIGHT: 0px; FONT-FAMILY: &lsquo;Courier New&rsquo;, courier, monospace; DIRECTION: ltr; BORDER-TOP-STYLE: none; COLOR: black; FONT-SIZE: 8pt; BORDER-LEFT-STYLE: none; OVERFLOW: visible; PADDING-TOP: 0px&rdquo;}
&lt;system.serviceModel>    <behaviors>        <serviceBehaviors>            <behavior>                <serviceMetadata httpGetEnabled="true"/>            </behavior>        </serviceBehaviors>    </behaviors>&lt;/system.serviceModel>
</del></p>

<p>\</p>

<p> </p>

<p>​4. Optionally, enable the ASP.NET Compatibility mode to use the ASP.NET
security context (Otherwise, the service will use the default security
settings for the basicHttpBinding). That will require two additional
steps, adding the “serviceHostingEnvironment” element in the existing
service model configuration.</p>

<p><del> {#codeSnippet style=&ldquo;BORDER-BOTTOM-STYLE: none; TEXT-ALIGN: left; PADDING-BOTTOM: 0px; LINE-HEIGHT: 12pt; BORDER-RIGHT-STYLE: none; BACKGROUND-COLOR: #f4f4f4; MARGIN: 0em; PADDING-LEFT: 0px; WIDTH: 100%; PADDING-RIGHT: 0px; FONT-FAMILY: &lsquo;Courier New&rsquo;, courier, monospace; DIRECTION: ltr; BORDER-TOP-STYLE: none; COLOR: black; FONT-SIZE: 8pt; BORDER-LEFT-STYLE: none; OVERFLOW: visible; PADDING-TOP: 0px&rdquo;}
&lt;system.serviceModel>    <serviceHostingEnvironment aspNetCompatibilityEnabled="true"/>
</del></p>

<p>\</p>

<p> </p>

<p>And adding an attribute in the service,</p>

<p><del> {#codeSnippet style=&ldquo;BORDER-BOTTOM-STYLE: none; TEXT-ALIGN: left; PADDING-BOTTOM: 0px; LINE-HEIGHT: 12pt; BORDER-RIGHT-STYLE: none; BACKGROUND-COLOR: #f4f4f4; MARGIN: 0em; PADDING-LEFT: 0px; WIDTH: 100%; PADDING-RIGHT: 0px; FONT-FAMILY: &lsquo;Courier New&rsquo;, courier, monospace; DIRECTION: ltr; BORDER-TOP-STYLE: none; COLOR: black; FONT-SIZE: 8pt; BORDER-LEFT-STYLE: none; OVERFLOW: visible; PADDING-TOP: 0px&rdquo;}
[AspNetCompatibilityRequirements(RequirementsMode=AspNetCompatibilityRequirementsMode.Allowed)]public class Service1 : IService1
</del></p>

<p>\</p>

<p>That’s all you need to implement a new WCF service that will behave as a
traditional ASMX webservice. As you can see, no service or binding
configurations were required for the service. In addition, the behavior
element does not have any name, so it applies to all the services
running in the same host.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/01/managing-the-so-aware-repository-with-powershell/">Managing the SO-Aware Repository With PowerShell</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-01T00:00:00-03:00" pubdate data-updated="true">Sep 1<span>st</span>, 2010</time>
        
         | <a href="/blog/2010/09/01/managing-the-so-aware-repository-with-powershell/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As Jesus mentioned in this
<a href="http://www.tellagostudios.com/tellago-studios-launching">post</a>,
SO-Aware provides three interfaces for managing the service repository.
An OData API in case you want to integrate third applications with the
repository. OData is a pure http API that can be easily consumed in any
platform using a simple http client library. The management portal,
which is an ASP.NET MVC user interface layered on top of the OData API
and probably the one most people will use. And finally, a PowerShell
provider that also mounts on top of the OData API to allow
administrators to automate management tasks over the repository with
scripting. </p>

<p>The SO-Aware PowerShell provider, in that sense offers around 40
commands that enables simple management scenarios like registering
bindings or services or more complex scenarios that involves testing
services or sending alerts when a service is not properly working.  </p>

<p>This provider can be registered as an snapin in an existing script using
the following command,</p>

<p><del> {#codeSnippet style=&ldquo;BORDER-BOTTOM-STYLE: none; TEXT-ALIGN: left; PADDING-BOTTOM: 0px; LINE-HEIGHT: 12pt; BORDER-RIGHT-STYLE: none; BACKGROUND-COLOR: #f4f4f4; MARGIN: 0em; PADDING-LEFT: 0px; WIDTH: 100%; PADDING-RIGHT: 0px; FONT-FAMILY: &lsquo;Courier New&rsquo;, courier, monospace; DIRECTION: ltr; BORDER-TOP-STYLE: none; COLOR: black; FONT-SIZE: 8pt; BORDER-LEFT-STYLE: none; OVERFLOW: visible; PADDING-TOP: 0px&rdquo;}
$snapin = get-pssnapin  | select-string &ldquo;SOAwareSnapIn&#8221;if ($snapin -eq $null){    Add-PSSnapin &#8220;SOAwareSnapIn&rdquo;}
</del></p>

<p>\</p>

<p>Once you have registered the snapin, you can start using most of the
commands for managing the repository.</p>

<p>The first and more important command is “Set-SWEndpoint”, which allows
you to connect to an existing SO-Aware instance. This command receives
the OData service location as first argument, and it looks as follow,</p>

<p><del> {#codeSnippet style=&ldquo;BORDER-BOTTOM-STYLE: none; TEXT-ALIGN: left; PADDING-BOTTOM: 0px; LINE-HEIGHT: 12pt; BORDER-RIGHT-STYLE: none; BACKGROUND-COLOR: #f4f4f4; MARGIN: 0em; PADDING-LEFT: 0px; WIDTH: 100%; PADDING-RIGHT: 0px; FONT-FAMILY: &lsquo;Courier New&rsquo;, courier, monospace; DIRECTION: ltr; BORDER-TOP-STYLE: none; COLOR: black; FONT-SIZE: 8pt; BORDER-LEFT-STYLE: none; OVERFLOW: visible; PADDING-TOP: 0px&rdquo;}
Set-SWEndpoint -uri <a href="http://localhost/SOAware/ServiceRepository.svc">http://localhost/SOAware/ServiceRepository.svc</a>
</del></p>

<p>\</p>

<p> </p>

<p>As next step, you can start managing or querying data from the
repository using the rest of the commands. For instance, the following
example registers a new binding in the repository only if it was not
created already</p>

<p><del> {#codeSnippet style=&ldquo;BORDER-BOTTOM-STYLE: none; TEXT-ALIGN: left; PADDING-BOTTOM: 0px; LINE-HEIGHT: 12pt; BORDER-RIGHT-STYLE: none; BACKGROUND-COLOR: #f4f4f4; MARGIN: 0em; PADDING-LEFT: 0px; WIDTH: 100%; PADDING-RIGHT: 0px; FONT-FAMILY: &lsquo;Courier New&rsquo;, courier, monospace; DIRECTION: ltr; BORDER-TOP-STYLE: none; COLOR: black; FONT-SIZE: 8pt; BORDER-LEFT-STYLE: none; OVERFLOW: visible; PADDING-TOP: 0px&rdquo;}
function RegisterBinding([string]$name,[string]$type,[string]$xml){    $binding = GetBinding($name);    if(!$binding)    {       Add-SWBinding -Name $name -BindingType $type -Configuration $xml    }}function GetBinding([string]$name){    $bindings = Get-SWBindings    foreach($binding in $bindings)    {        if($binding.Name -eq $name)        {            return $binding        }    }}RegisterBinding &ldquo;stsBinding&rdquo; &ldquo;ws2007HttpBinding&rdquo; &ldquo;<binding>        <security mode='Message'>            <message clientCredentialType='UserName' establishSecurityContext='false' negotiateServiceCredential='false'/>        </security> </binding>&rdquo;;
</del></p>

<p>\</p>

<p>As you can see, this provider brings a powerful toy that administrators
in any organization can use to manage services or governance aspects by
leveraging their scripting knowledge.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/27/some-wif-interop-gotchas/">Some WIF Interop Gotchas</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-27T00:00:00-03:00" pubdate data-updated="true">Aug 27<span>th</span>, 2010</time>
        
         | <a href="/blog/2010/08/27/some-wif-interop-gotchas/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>WIF is an excellent framework that allows you to develop an STS in just
a few minutes if you know exactly what you are doing of course :). In my
role as consultant and architect in Tellago, I went through several
projects in which some level of customization was required at wire level
to accomplish some interoperability between a STS built with WIF and
existing federation solutions like ADFS 1.x and OpenSSO.</p>

<p>The idea of this post is to show some of extensibility points that you
will find in WIF to customize the WS-Trust messages, and issued tokens.</p>

<p><strong>1. Making WIF to speak WS-Trust Feb 2005</strong></p>

<p>WIF uses by default WS-Trust 1.3, which means that all the generated
WS-Trust messages will use that spec unless you specify a different one.
ADFS 1.x and OpenSSO both uses WS-Trust Feb 2005
(<a href="http://schemas.xmlsoap.org/ws/2005/02/trust">http://schemas.xmlsoap.org/ws/2005/02/trust</a>)
for the passive profile to support single sign on over the web.
Therefore, if you want to generate WS-Trust messages that follow that
spec version in your WIF passive STS, you need to modify a little bit
the code you use for processing the RST messages.</p>

<p><del> {#codeSnippet style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
class FederatedPassiveSecurityTokenServiceOperations{    public static void ProcessRequest(HttpRequest request, IPrincipal principal,         SecurityTokenService sts, HttpResponse response,         WSFederationSerializer federationSerializer);    public static SignInResponseMessage ProcessSignInRequest(SignInRequestMessage requestMessage,         IPrincipal principal, SecurityTokenService sts,         WSFederationSerializer federationSerializer);}
</del></p>

<p>\</p>

<p>The methods ProcessRequest and ProcessSignRequest in the
FederatedPassiveSecurityTokenServiceOperations class both support an
additional overload for passing the WS-Trust version
(WSFederationSerializer instance).</p>

<p>You can force another WS-Trust version by passing the right serializer
instance. For example, the following code uses the WS-Trust Feb 2005
specification.</p>

<p><del> {#codeSnippet style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
SignInResponseMessage responseMessage = FederatedPassiveSecurityTokenServiceOperations.ProcessSignInRequest(    requestMessage, User, sts,         new WSFederationSerializer(new WSTrustFeb2005RequestSerializer(),             new WSTrustFeb2005ResponseSerializer()));
</del></p>

<p>\</p>

<p><strong>2. Changing the SAML token’s signature algorithms</strong></p>

<p>WIF uses by default a combination of RSA and SHA 256 for generating the
SAML signature. You can notice this in the generated SAML token,</p>

<p><del> {#codeSnippet style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
&lt;saml:Attribute AttributeName=&ldquo;name&rdquo; AttributeNamespace=&ldquo;<a href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims">http://schemas.xmlsoap.org/ws/2005/05/identity/claims</a>&rdquo;>    &lt;saml:AttributeValue>MyName&lt;/saml:AttributeValue>  &lt;/saml:Attribute>&lt;/saml:AttributeStatement>&lt;ds:Signature xmlns:ds=&ldquo;<a href="http://www.w3.org/2000/09/xmldsig#">http://www.w3.org/2000/09/xmldsig#</a>&rdquo;>  &lt;ds:SignedInfo>    &lt;ds:CanonicalizationMethod Algorithm=&ldquo;<a href="http://www.w3.org/2001/10/xml-exc-c14n#">http://www.w3.org/2001/10/xml-exc-c14n#</a>&rdquo; />    &lt;ds:SignatureMethod Algorithm=&ldquo;<a href="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256">http://www.w3.org/2001/04/xmldsig-more#rsa-sha256</a>&rdquo; />    &lt;ds:Reference URI=&ldquo;#_cecf3c23-824e-4064-846c-b90c03d29700&rdquo;>      &lt;ds:Transforms>        &lt;ds:Transform Algorithm=&ldquo;<a href="http://www.w3.org/2000/09/xmldsig#enveloped-signature">http://www.w3.org/2000/09/xmldsig#enveloped-signature</a>&rdquo; />        &lt;ds:Transform Algorithm=&ldquo;<a href="http://www.w3.org/2001/10/xml-exc-c14n#">http://www.w3.org/2001/10/xml-exc-c14n#</a>&rdquo; />      &lt;/ds:Transforms>      &lt;ds:DigestMethod Algorithm=&ldquo;<a href="http://www.w3.org/2001/04/xmlenc#sha256">http://www.w3.org/2001/04/xmlenc#sha256</a>&rdquo; />      &lt;ds:DigestValue>1flG08Axm71C0isY2wLR0C9jqgfIebNoG2nlIO+jO+s=&lt;/ds:DigestValue>    &lt;/ds:Reference> &lt;/ds:SignedInfo>
</del></p>

<p>\
ADFS 1.x and OpenSSO use a combination of RSA and SHA, so that’s also
something else you need to customize. The “X509SigningCredentials”
instance that you pass in the constructor of the Secure token service
configuration also contains an overload to change the signature
algorithm. The following code creates a new instance of
“X509SigningCredentials” that uses SHA rather than SHA 256.</p>

<p> </p>

<p><del> {#codeSnippet style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
new X509SigningCredentials(    CertificateUtil.GetCertificate(StoreName.TrustedPeople,         StoreLocation.LocalMachine,         &ldquo;CN=Test&rdquo;),     &ldquo;<a href="http://www.w3.org/2000/09/xmldsig#rsa-sha1">http://www.w3.org/2000/09/xmldsig#rsa-sha1</a>&rdquo;,     &ldquo;<a href="http://www.w3.org/2000/09/xmldsig#sha1">http://www.w3.org/2000/09/xmldsig#sha1</a>&rdquo;))
</del></p>

<p>\</p>

<p><strong>3. Adding an authentication statement to the issued SAML token</strong></p>

<p> </p>

<p>This part is very tricky, as WIF does not add by default an
authentication statement in the SAML token unless you use an specific
claim type (NameIdentifier) with some custom properties.</p>

<p> </p>

<p><del> {#codeSnippet style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
Claim nameIdentifier = new Claim(System.IdentityModel.Claims.ClaimTypes.NameIdentifier,     &ldquo;<a href="&#109;&#x61;&#105;&#x6c;&#116;&#x6f;&#x3a;&#102;&#111;&#111;&#x40;&#116;&#x65;&#x73;&#116;&#46;&#x63;&#111;&#x6d;">&#102;&#x6f;&#x6f;&#64;&#116;&#101;&#x73;&#x74;&#x2e;&#99;&#111;&#x6d;</a>&rdquo;);nameIdentifier.Properties[&ldquo;<a href="http://schemas.xmlsoap.org/ws/2005/05/identity/claimproperties/format">http://schemas.xmlsoap.org/ws/2005/05/identity/claimproperties/format</a>&rdquo;]     = &ldquo;<a href="http://schemas.xmlsoap.org/claims/UPN">http://schemas.xmlsoap.org/claims/UPN</a>&rdquo;;outputIdentity.Claims.Add(nameIdentifier);outputIdentity.Claims.Add(new Claim(ClaimTypes.AuthenticationMethod, &ldquo;<a href="http://microsoft/geneva">http://microsoft/geneva</a>&rdquo;));outputIdentity.Claims.Add(new Claim(ClaimTypes.AuthenticationInstant, XmlConvert.ToString(DateTime.Now, XmlDateTimeSerializationMode.Utc)));
</del></p>

<p>\</p>

<p>The code above will generate an authentication statement like this in
the SAML token, which is something equivalent to what ADFS 1.x or
OpenSSO would generate.</p>

<p><del> {#codeSnippet style=&ldquo;border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &lsquo;Courier New&rsquo;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px&rdquo;}
&lt;saml:AttributeStatement>  &lt;saml:Subject>    &lt;saml:NameIdentifier Format=&ldquo;<a href="http://schemas.xmlsoap.org/claims/UPN">http://schemas.xmlsoap.org/claims/UPN</a>&rdquo;>        <a href="&#109;&#97;&#x69;&#108;&#x74;&#111;&#x3a;&#102;&#111;&#x6f;&#x40;&#116;&#x65;&#115;&#x74;&#x2e;&#x63;&#111;&#109;">&#x66;&#x6f;&#111;&#64;&#x74;&#101;&#115;&#x74;&#46;&#99;&#111;&#x6d;</a>    &lt;/saml:NameIdentifier>    &lt;saml:SubjectConfirmation>      &lt;saml:ConfirmationMethod>            urn:oasis:names:tc:SAML:1.0:cm:bearer        &lt;/saml:ConfirmationMethod>    &lt;/saml:SubjectConfirmation>  &lt;/saml:Subject>    &lt;/saml:AttributeStatement>
</del></p>

<p>\</p>

<p> </p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/10/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/31/making-ajax-calls-with-hawk-authentication-to-asp-dot-net-web-api/">Making Ajax Calls With Hawk Authentication to ASP.NET Web API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/13/coordinating-async-work-in-node-dot-js/">Coordinating Async Work in Node.js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/27/oauth-bridge-for-adfs-with-thinkteckture-authorization-server/">OAuth Bridge for ADFS With ThinkTecture Authorization Server</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/22/automatic-client-cert-detection-in-adfs-2-dot-0/">Automatic Client Cert Detection in ADFS 2.0</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/21/injecting-dynamic-content-in-windows-azure-package/">Injecting Dynamic Content in Windows Azure Packages</a>
      </li>
    
  </ul>
</section>
 <a href="http://feeds.feedburner.com/cibrax"><img src="http://feeds.feedburner.com/~fc/cibrax?bg=FF3300&amp;fg=000000&amp;anim=0" style="border:0" alt="" /></a>

 <script type="text/javascript" language="javascript" src="http://twittercounter.com/embed/?username=cibrax&style=white"></script>
<a href="https://mvp.microsoft.com/en-us/mvp/Pablo%20Cibraro-33800"><img src="/images/mvp.gif" border="0" /></a>
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/pcibraro">@pcibraro</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pcibraro',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Cibrax -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'cibrax';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
