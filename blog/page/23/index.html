
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pablo Cibraro (Cibrax)</title>
  <meta name="author" content="Cibrax">

  
  <meta name="description" content="I updated the WS-Compression code to make it work with the latest WCF
release. You can download it from this
location
">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cibrax.me/blog/page/23">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/cibrax" rel="alternate" title="Pablo Cibraro (Cibrax)" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44468149-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Pablo Cibraro (Cibrax)</a></h1>
  
    <h2>All about software development.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/cibrax" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:cibrax.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/09/13/WS_2D00_Compression-for-WCF-RC1-_2800_September_2900_/">WS-Compression for WCF RC1 (September)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-09-13T00:00:00-03:00" pubdate data-updated="true">Sep 13<span>th</span>, 2006</time>
        
         | <a href="/blog/2006/09/13/WS_2D00_Compression-for-WCF-RC1-_2800_September_2900_/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I updated the WS-Compression code to make it work with the latest WCF
release.</p>

<p>You can download it from this
<a href="/images/legacy/WCFCompression-RC1.zip">location</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/09/08/SAML-_2D00_-STS-implementation-for-WCF/">SAML - STS Implementation for WCF</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-09-08T00:00:00-03:00" pubdate data-updated="true">Sep 8<span>th</span>, 2006</time>
        
         | <a href="/blog/2006/09/08/SAML-_2D00_-STS-implementation-for-WCF/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I finally decided to publish a STS implementation for WCF.  (It is based
on one of my previous posts, <a href="/cibrax/archive/2006/03/14/440222.aspx">&ldquo;Implementing a Secure token service with
WCF&rdquo;</a>)</p>

<p>I received a lot of mails from people asking me for a official version
of that code, so here it
<a href="/images/legacy/STSExample.zip">is</a>. I implemented this
STS using latest WCF release (September CTP).</p>

<p>All the classes previously provided by WCF to parse the RST and RSTR
messages have gone (They are now private). I am not sure about the
reason to take that decision, but it certainly complicates everything.</p>

<p>Therefore, a person developing a STS (me) has only two options:</p>

<ol>
<li>Create different classes to parse those messages. In other words,
duplicate all the code previously provided by WCF</li>
<li>Copy that code from the <a href="http://pluralsight.com/blogs/mgudgin/archive/2006/06/19/28503.aspx">Martin Gudgin&rsquo;s
implementation</a>
(Same as 1, but it makes your life easier).  </li>
</ol>


<p>The code also includes the following features:</p>

<ul>
<li>A custom Security Token Manager to reuse the same SAML token
instance in different WCF channels. You can find more information
about this solution in this
<a href="/cibrax/archive/2006/03/27/441227.aspx">post</a>. This token manager
is quite simple, and it only shows how this task can be performed. </li>
<li>Two configuration files showing different binding settings between
the client, the service and the STS. The first one uses the standar
wsFederationHttpBinding, and the last one uses customBindings.</li>
</ul>


<p>Download the code from this
<a href="/images/legacy/STSExample.zip">location</a></p>

<p>Update, feedback received from the WCF team regarding the RST/RSTR
classes:</p>

<p><em>&ldquo;We made those classes internal during our RC1 milestone because this
will enable us to align the product better for future version of the
WS-Trust protocol without exposing user to the necessary changes. When
doing this we have actually changed our samples that show our Federation
feature so that those samples now contain source code of RST/RSTR
library that you can use to parse RST and RSTR messages in your
application. For example the FederationHttp binding sample in the
Windows SDK in WCF samples collection contains source code for parsing
RST/RSTR messages. It can be found in
TechnologySamples\Basic\Binding\WS\FederationHttp directory. I hope
this answers your concern. Thanks, &mdash;Jan&#8221; </em>\
 </p>

<p> </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/23/Securing-web-services/">Securing Web Services</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-23T00:00:00-03:00" pubdate data-updated="true">Aug 23<span>rd</span>, 2006</time>
        
         | <a href="/blog/2006/08/23/Securing-web-services/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post discusses first the most important aspects to consider
regarding security, and then, how these aspects are implemented with web
services.</p>

<h3>Security Aspects</h3>

<p>Sending and receiving plain text messages through unsecured networks can
lead to attacks performed by an attacker who potentially can intercept
these messages and modify them for malicious purposes.</p>

<p>By using some security mechanisms, the sensitive data can be protected
against threats such as eavesdropping or data tampering.</p>

<p>Usually, the following security aspects are considered for any
application:</p>

<ul>
<li><strong><em>Authentication</em></strong>: Is the process of identifying the user, and
making sure that the user is who he says he is.</li>
<li><strong><em>Authorization</em></strong>: Defines the rights and permissions of users.</li>
<li><strong><em>Message Integrity</em></strong>: Guarantees that a message has not been
changed in transit.</li>
<li><strong><em>Message Confidentiality</em></strong>: Encrypts a message so that
unauthorized entities cannot view its content.</li>
<li><strong><em>Non-Repudiation</em></strong>: Guarantees that the sender of a message
cannot later deny having sent the message and that the recipient
cannot deny having received it.</li>
</ul>


<h3>Transport security vs. Message layer security</h3>

<p>This is worth mentioning since the difference between these two modes to
assure security between two endpoints is not generally known.</p>

<h4><strong>Transport security</strong></h4>

<p>Transport security represents an approach where the underlying transport
or application servers are used to handle security features. When the
message leaves the transport, it is no longer secure. For example,
Secure Sockets Layer (SSL) is a common transport layer approach that is
used to provide encryption.</p>

<p>This approach does not support multiple intermediates, if a message
needs to go through multiple endpoints to reach its destination, each
intermediate point must forward the message over a new SSL connection
(the original message from the client is not protected on each
intermediary).</p>

<p> </p>

<h4><strong>Message security</strong></h4>

<p>Message layer security represents an approach where all the information
related to security is encapsulated in the message. Securing the message
using this approach instead of using transport security has several
advantages that include:</p>

<p> </p>

<ul>
<li><strong>Increased flexibility</strong>: Parts of the message, instead of the
entire message, can be encrypted or signed. This means that
intermediaries can view parts of the message that are intended for
them.</li>
<li><strong>Support for multiple transports</strong>: The secured messages can be
sent over many different transports, such as Simple Mail Transfer
(SMTP), HTTP, Message Queues, without having to rely on the protocol
for security. The message is still secure after taking it out from
the underlying transport.</li>
</ul>


<h3><strong><em>Web Services</em></strong></h3>

<p>The web services by themselves do not provide the quality of service
required by many business applications these days. (e.g. transactions,
security, and reliability).</p>

<p>Due to that reason, different vendors such as Microsoft, Oracle, IBM,
Sun and others have coordinated their efforts to improve that quality of
service, and as result of this work, they developed the WS-* protocols.</p>

<p>WS-* is the name for a set of protocols that extend the normal web
service functionality modifying the SOAP messages (They work at message
level).</p>

<p>For the moment, these are some of the available protocols that can be
used to provide a better quality of service:</p>

<p> </p>

<ul>
<li><strong>WS-Security</strong>: Describes enhancements to SOAP messaging to provide
message integrity, message confidentiality, and single message
authentication. The specified mechanisms can be used to accommodate
a wide variety of security models and encryption technologies.</li>
<li><strong>WS-Addressing:</strong>Provides transport-neutral mechanisms to address
web services and messages. Specifically, this specification defines
XML elements to identify web services endpoints and to secure
end-to-end endpoint identification in messages. In other words, it
enables message transmission in a transport-neutral manner.
Therefore, HTTP is no longer required as unique transport for web
services, and other kinds of transports can be used, such as SMTP,
TCP, and even MSMQ.</li>
<li><strong>MTOM:</strong>Provides a mechanism for optimizing the transmission and/or
wire format of a SOAP message when file attachments need to be
included.</li>
<li><strong>WS-ReliableMessaging</strong>:  Describes a protocol that allows messages
to be delivered reliably between distributed applications in the
presence of software components, system, or network failures. This
protocol can be implemented using different network transport
technologies.</li>
<li><strong>WS-Transaction:</strong>Provides a mechanism to establish short-lived
distributed transactions between applications that have
all-or-nothing semantics.</li>
</ul>


<hr />

<p>Microsoft already implemented WS-Security, WS-Addressing and MTOM in the
Microsoft WSE framework, but it is planning to implement all of them in
WCF (Windows Communication Foundation). WCF is a messaging framework to
build distributed application that will be available in a couple of
months.</p>

<p> </p>

<p>Below, a summary about the advantages of using web services.</p>

<p> </p>

<p><strong>Advantages</strong></p>

<hr />

<ul>
<li>It is highly interoperable. Almost all the application vendors
support basic web services and the WS-* specifications as well.</li>
<li>It works in a transport-neutral manner, any transport can be used.</li>
<li>It is based on XML and other open standards. The application does
not need to provide a custom mechanism to parse or transport the
messages.</li>
<li>They can provide message authentication, integrity and
confidentiality.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/08/Creating-X509-Certificates-for-WSE-or-WCF/">Creating X509 Certificates for WSE or WCF</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-08T00:00:00-03:00" pubdate data-updated="true">Aug 8<span>th</span>, 2006</time>
        
         | <a href="/blog/2006/08/08/Creating-X509-Certificates-for-WSE-or-WCF/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>What certificate to use or where to get one of these, is perhaps is one
the most common question I read often in the MS newsgroups.\
Well, for starters, there are many kinds of X509 certificates around,
each one for a different purpose. And to make the matters worse, each
vendor offers similar certificates with different names.\
<a href="http://www.verisign.com/" title="Verisign">Verisign</a>,
<a href="http://www.rsasecurity.com/" title="RSA">RSA</a>,
<a href="http://www.thawte.com/" title="Thawte">Thawte</a> and others usually offer
certificates for the following purposes:</p>

<p>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| <strong>Purpose</strong>        | <strong>Description</strong>    | <strong>Data Signing     |  </strong>Key Exchange    |
|                    |                    | Support<strong>          | support</strong>          |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| Code Signing       | A code signing     | Yes                | No                 |
|                    | certificate is     |                    |                    |
|                    | usually            |                    |                    |
|                    | recommended for    |                    |                    |
|                    | any publisher who  |                    |                    |
|                    | plans to           |                    |                    |
|                    | distribute code or |                    |                    |
|                    | content over the   |                    |                    |
|                    | Internet or        |                    |                    |
|                    | corporate          |                    |                    |
|                    | extranets and      |                    |                    |
|                    | needs to assure    |                    |                    |
|                    | the integrity and  |                    |                    |
|                    | authorship of that |                    |                    |
|                    | code               |                    |                    |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| E-Mail Security    | An e-mail          | Yes                | No                 |
|                    | certificate can be |                    |                    |
|                    | used to digitally  |                    |                    |
|                    | sign email         |                    |                    |
|                    | messages or        |                    |                    |
|                    | to encrypt email   |                    |                    |
|                    | contents and       |                    |                    |
|                    | attachments.       |                    |                    |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| SSL                | A SSL certificate  | Yes                | No                 |
|                    | is usually         |                    |                    |
|                    | configured in a    |                    |                    |
|                    | web site to offer  |                    |                    |
|                    | SSL protection     |                    |                    |
|                    | (HTTPS)            |                    |                    |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+</p>

<p> </p>

<p> </p>

<p>The WSE&rsquo;s turn-key assertions always require certificates with data
signing and key exchange support. The data signing support is used to
generate XML signatures and the key exchange function is used to 
encrypt data (It actually creates a EncryptedKey, for more information
about this, read this <a href="/cibrax/archive/2005/10/04/426585.aspx" title="blog entry">blog
entry</a>). However, a
custom security assertion can be created to use different certificates
for data signing and data encryption. I did something like that in one
of the projects where I worked, you can take a look to the code in this
<a href="http://www.gotdotnet.com/codegallery/codegallery.aspx?id=0fecd2c7-b2b1-4d85-bd66-9d07a6ecbd86" title="GDN workspace">GDN
workspace</a>\
On the other hand, WCF allows to specify different certificates for data
signing and key interchange by means of the X509 Security Token
providers. \
Another approach and probably most attractive in many organizations is
to create custom X509 certificates using an in-house certificate
authority. Microsoft comes with two solutions out of the box to generate
certificates, the tool &ldquo;MakeCert.exe&rdquo; to create test certificates for
development environments and a more robust solution, Microsoft
Certificate Server (MCS), to configure a real PKI in the organization.</p>

<p><strong>Creating Certificates with MCS</strong></p>

<p>In a nutshell, Microsoft Certificate Server is a product that allows to
mount a real PKI in any organization. This product can run in two modes,
Active directory integrated or stand alone. This last one is
probably useful for software development organizations or independent
consultants working on products that require certificates.\
Microsoft also provides a component <strong>CertEnroll</strong> to automate the
process of creating and asking certificates to the
certificate authority.\
In the following paragraphs I will show how to use this component
to create a valid X509 certificate to be used in WSE or WCF. </p>

<p>The creation of a certificate in MCS involves two steps:</p>

<p>​1. Send a certificate request to the Certificate Authority\
2. Obtain the certificate from the Certificate Authority after
the request was authorized</p>

<p>The CertEnroll COM contains methods to perform both steps, still some
lines of code are required. The code below illustrates how to request
and obtain a certificate from a CA (I wrote the code in vbscript).</p>

<hr />

<p>  \
  Option Explicit \
  const CERT_SYSTEM_STORE_LOCAL_MACHINE = &amp;H20000\
  const CRYPT_EXPORTABLE = 1 \
  \
  Const AT_KEYEXCHANGE = 1 \
  Const AT_SIGNATURE = 2 \
  Const CRYPT_ARCHIVABLE = &amp;H000004000 \
  Const RSA1024BIT_KEY = &amp;H04000000 \
  \
  Const XECR_PKCS10_V2_0 = 1 \
  Const XECR_PKCS7 = 2 \
  Const XECR_CMC = 3 \
  Const XECR_PKCS10_V1_5 = 4 \
  \
  Const CR_OUT_BASE64HEADER = 0 \
  Const CR_OUT_BASE64 = 1 \
  Const CR_OUT_BINARY = 2 \
  Const CR_OUT_CHAIN = &amp;h100 \
  Const CR_IN_BASE64HEADER = 0 \
  Const CR_IN_BASE64 = &amp;H1 \
  Const CR_IN_PKCS10 = &amp;H100 \
  Const CR_IN_KEYGEN = &amp;H200 \
  Const CR_IN_ENCODEANY = &amp;Hff \
  Const CR_IN_FORMATANY = 0 \
  \
  Const CR_DISP_INCOMPLETE = 0 \
  Const CR_DISP_ERROR = 1 \
  Const CR_DISP_DENIED = 2 \
  Const CR_DISP_ISSUED = 3 \
  Const CR_DISP_ISSUED_OUT_OF_BAND = 4 \
  Const CR_DISP_UNDER_SUBMISSION = 5 \
  Const CR_DISP_REVOKED = 6 \
  \
  \
  Const PROPTYPE_LONG = 1 \
  Const PROPTYPE_DATE = 2 \
  Const PROPTYPE_BINARY = 3 \
  Const PROPTYPE_STRING = 4 \
  \
  \
  Const CR_GEMT_HRESULT_STRING = 1 \
  \
  \
  Const FR_PROP_NONE = 0 &lsquo; Invalid \
  Const FR_PROP_FULLRESPONSE = 1 &rsquo; Binary \
  Const FR_PROP_STATUSINFOCOUNT = 2 &lsquo; Long \
  Const FR_PROP_BODYPARTSTRING = 3 &rsquo; String, Indexed \
  Const FR_PROP_STATUS = 4 &lsquo; Long, Indexed \
  Const FR_PROP_STATUSSTRING = 5 &rsquo; String, Indexed \
  Const FR_PROP_OTHERINFOCHOICE = 6 &lsquo; Long, Indexed \
  Const FR_PROP_FAILINFO = 7 &rsquo; Long, Indexed \
  Const FR_PROP_PENDINFOTOKEN = 8 &lsquo; Binary, Indexed \
  Const FR_PROP_PENDINFOTIME = 9 &rsquo; Date, Indexed \
  Const FR_PROP_ISSUEDCERTIFICATEHASH =10 &lsquo; Binary, Indexed \
  Const FR_PROP_ISSUEDCERTIFICATE =11 &rsquo; Binary, Indexed \
  Const FR_PROP_ISSUEDCERTIFICATECHAIN =12 &lsquo; Binary, Indexed \
  Const FR_PROP_ISSUEDCERTIFICATECRLCHAIN=13 &rsquo; Binary, Indexed \
  Const FR_PROP_ENCRYPTEDKEYHASH =14 &lsquo; Binary, Indexed \
  Const FR_PROP_FULLRESPONSENOPKCS7 =15 &rsquo; Binary \
  \
  \
  Const KeyLength = 1024 \
  \
  \
  Dim CertEnroll \
  \
  \
  Set CertEnroll = CreateObject( &ldquo;CEnroll.CEnroll&rdquo; ) \
  \
  \
  Dim RequestStr, CertRequest, Disposition, ID \
  \
  \
  CertEnroll.ProviderName = &ldquo;Microsoft Enhanced Cryptographic Provider v1.0&rdquo; \
  CertEnroll.KeySpec = AT_KEYEXCHANGE \
  CertEnroll.GenKeyFlags = CRYPT_EXPORTABLE \
  \
  \
  RequestStr = CertEnroll.createRequest( XECR_CMC, &ldquo;CN=John Smith&rdquo;, &ldquo;1.3.6.1.5.5.7.3.2&rdquo; ) \
  \
  \
  Set CertRequest = CreateObject( &ldquo;CertificateAuthority.Request&rdquo; ) \
  Disposition = CertRequest.Submit( _ \
  CR_IN_ENCODEANY Or CR_IN_FORMATANY, _ \
  RequestStr, _ \
  &ldquo;&rdquo;, _ \
  &ldquo;Localhost\MyCertAuth&rdquo; ) \
  \
  \
  ID = CertRequest.GetRequestId \
  \
  \
  MsgBox ID \
  \</p>

<hr />

<p> </p>

<p>In a few words, the code above submits a certificate request to a MCS
service running on &#8221;Localhost\MyCertAuth&#8221;. The certificate distinguish
name will be &ldquo;CN=Jonh Smith&rdquo; and the long number &ldquo;1.3.6.1.5.5.7.3.2&rdquo;
only describes the purpose of the certificate. (MCS provides a set of
templates, each one with a different number identifier). \
It is important to store the RequestId in some place since it will be
necessary later to retrieve the certificate from the CA (Once the
request was authorized by one of the CA administrators).</p>

<p> </p>

<hr />

<p>  Option Explicit \
  \
  const CERT_SYSTEM_STORE_LOCAL_MACHINE = &amp;H20000 \
  const CRYPT_EXPORTABLE = 1 \
  \
  Const AT_KEYEXCHANGE = 1 \
  Const AT_SIGNATURE = 2 \
  Const CRYPT_ARCHIVABLE = &amp;H000004000 \
  Const RSA1024BIT_KEY = &amp;H04000000 \
  \
  Const XECR_PKCS10_V2_0 = 1 \
  Const XECR_PKCS7 = 2 \
  Const XECR_CMC = 3 \
  Const XECR_PKCS10_V1_5 = 4 \
  \
  \
  Const CR_OUT_BASE64HEADER = 0 \
  Const CR_OUT_BASE64 = 1 \
  Const CR_OUT_BINARY = 2 \
  Const CR_OUT_CHAIN = &amp;h100 \
  \
  Const CR_IN_BASE64HEADER = 0 \
  Const CR_IN_BASE64 = &amp;H1 \
  Const CR_IN_PKCS10 = &amp;H100 \
  Const CR_IN_KEYGEN = &amp;H200 \
  Const CR_IN_ENCODEANY = &amp;Hff \
  Const CR_IN_FORMATANY = 0 \
  \
  \
  Const CR_DISP_INCOMPLETE = 0 \
  Const CR_DISP_ERROR = 1 \
  Const CR_DISP_DENIED = 2 \
  Const CR_DISP_ISSUED = 3 \
  Const CR_DISP_ISSUED_OUT_OF_BAND = 4 \
  Const CR_DISP_UNDER_SUBMISSION = 5 \
  Const CR_DISP_REVOKED = 6 \
  \
  \
  Const PROPTYPE_LONG = 1 \
  Const PROPTYPE_DATE = 2 \
  Const PROPTYPE_BINARY = 3 \
  Const PROPTYPE_STRING = 4 \
  \
  \
  Const CR_GEMT_HRESULT_STRING = 1 \
  Const FR_PROP_NONE = 0 &lsquo; Invalid \
  Const FR_PROP_FULLRESPONSE = 1 &rsquo; Binary \
  Const FR_PROP_STATUSINFOCOUNT = 2 &lsquo; Long \
  Const FR_PROP_BODYPARTSTRING = 3 &rsquo; String, Indexed \
  Const FR_PROP_STATUS = 4 &lsquo; Long, Indexed \
  Const FR_PROP_STATUSSTRING = 5 &rsquo; String, Indexed \
  Const FR_PROP_OTHERINFOCHOICE = 6 &lsquo; Long, Indexed \
  Const FR_PROP_FAILINFO = 7 &rsquo; Long, Indexed \
  Const FR_PROP_PENDINFOTOKEN = 8 &lsquo; Binary, Indexed \
  Const FR_PROP_PENDINFOTIME = 9 &rsquo; Date, Indexed \
  Const FR_PROP_ISSUEDCERTIFICATEHASH =10 &lsquo; Binary, Indexed \
  Const FR_PROP_ISSUEDCERTIFICATE =11 &rsquo; Binary, Indexed \
  Const FR_PROP_ISSUEDCERTIFICATECHAIN =12 &lsquo; Binary, Indexed \
  Const FR_PROP_ISSUEDCERTIFICATECRLCHAIN=13 &rsquo; Binary, Indexed \
  Const FR_PROP_ENCRYPTEDKEYHASH =14 &lsquo; Binary, Indexed \
  Const FR_PROP_FULLRESPONSENOPKCS7 =15 &rsquo; Binary \
  \
  \
  Const KeyLength = 1024 \
  \
  \
  Dim CertEnroll, CertRequest \
  Dim Disposition \
  \
  \
  Set CertEnroll = CreateObject( &ldquo;CEnroll.CEnroll&rdquo; ) \
  Set CertRequest = CreateObject( &ldquo;CertificateAuthority.Request&rdquo; ) \
  Disposition = CertRequest.GetIssuedCertificate(&ldquo;localhost\MyCertAuth&rdquo;, 24, &ldquo;&rdquo;) \
  \
  \
  If Disposition = CR_DISP_ISSUED Then \
  \
  Dim Cert \
  \
  Cert = CertRequest.GetFullResponseProperty( _ \
  \
  FR_PROP_FULLRESPONSE, _ \
  \
  0, _ \
  \
  PROPTYPE_BINARY, _ \
  \
  CR_OUT_BASE64 ) \
  \
  \
  \
  Dim sCert \
  \
  sCert = CertEnroll.getCertFromResponse(Cert) \
  \
  \
  \
  CertEnroll.createFilePFX &ldquo;password&rdquo;, &ldquo;c:\cert.pfx&rdquo; \
  Else \
  \
  WScript.echo &ldquo;Disposition = &rdquo; + cstr( Disposition ) \
  \
  If CertRequest.GetLastStatus &lt;> 0 Then \
  \
  \
  \
  WScript.echo &ldquo;Error : &rdquo; + cstr( CertRequest.GetErrorMessageText( _ \
  \
  \
  \
  CertRequest.GetLastStatus, CR_GEMT_HRESULT_STRING )) \
  \
  \
  End If \
  End If \</p>

<hr />

<p> </p>

<p>The code above retrieves the certificate for the request id 24 (It is
only an example, the real id should be used there) and stores it on the
file &ldquo;c:\cert.pfx&rdquo; (By the way, this is not a good practice since the
certificate can be copied).</p>

<p> </p>

<p><strong>Creating Certificates with MakeCert</strong></p>

<p> </p>

<p>MakeCert is a tool provided by Microsoft to create test certificates
that can be used during the development of a product (For developing and
testing purposes only). These certificates have also performance
problems, certain cryptographic operations may perform slowly when they
are used. Certificates issued from a true Certificate Authority do not
have this problem, and it is a know issue.</p>

<p>In order to create a certificate with this tool, the following arguments
must be considered:</p>

<ul>
<li>sr: Store Location, it can be LocalMachine or CurrentUser\</li>
<li>ss: Store Folder, it can take different values but these are probably
the most common, My (Personal) or Trusted (Trusted Folder).\
- n: Certificate Distinguished name. It is very import to chose a right
name for the certificate since it will identify it. (This name is also
used to look for the certificate)</li>
</ul>


<p>For example,</p>

<p>makecert.exe -sr LocalMachine -ss My -a sha1 -n CN=MyServerCert -sky
exchange -pe </p>

<p>This tool only generates and stores the certificate in the certificate
store, but it does not assign any permission on that certificate. If you
planning to use the certificate from WSE or WSE, you may need to give
read permission to the account running the service, for instance the
account ASPNET for a normal web service.\
Microsoft provides another tool to grant permissions on certificates,
the name of this tool is <strong>winhttpcertcfg</strong>.\
The following sample, grant permission on the certificate created above
to the ASPNET account:</p>

<p>winhttpcertcfg -g -c LOCAL_MACHINE\My -s MyServerCert -a ASPNET</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/07/10/Interoperability-between-WSE-2.0-and-WCF/">Interoperability Between WSE 2.0 and WCF</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-07-10T00:00:00-03:00" pubdate data-updated="true">Jul 10<span>th</span>, 2006</time>
        
         | <a href="/blog/2006/07/10/Interoperability-between-WSE-2.0-and-WCF/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.softwaremaker.net/blog">William Tay (Aka Softwaremaker)</a> one
of the most  knowledgeable WSE guys around has published an excellent
article about interoperability between WSE 2.0 and WCF.\
I usually find people concerned about topics like this, the different
interop issues between WSE 2.0, WSE 3.0 and WCF. \
Well, this article really helps clarify the required points to make both
products work together. In addition, it includes some code samples.</p>

<p>You can find the article
<a href="http://wcf.netfx3.com/content/WindowsCommunicationFoundationWCFInteroperabilityandMigrationwithWSE20.aspx" title="here">here</a> </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/06/19/Making-WSE-3.0-work-with-WSS4J-and-X509-certificates/">Making WSE 3.0 Work With WSS4J and X509 Certificates</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-06-19T00:00:00-03:00" pubdate data-updated="true">Jun 19<span>th</span>, 2006</time>
        
         | <a href="/blog/2006/06/19/Making-WSE-3.0-work-with-WSS4J-and-X509-certificates/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I found this interesting <a href="http://www.oftedal.no/~erlend/?blogid=12" title="blog entry">blog
entry</a> to making
WSS4J (Axis) work with WSE 3.0 using a Mutual X509 scenario (There are
two certificates, the first one for client authentication and the second
one for message protection).\
Since WSE 3.0 and WCF are compatible at wire level (I have already
developed a <a href="/cibrax/archive/2006/04/19/443402.aspx" title="sample">sample</a> to
show this), this entry is also useful for interop testing between WCF
and WSS4J.</p>

<p>Some points to consider:</p>

<p>​1. It uses the August 2004 WS-Adressing Spec (The only one supported in
WSE 3.0)\
2. It uses WS-Security 1.0 (MutualCertificate10Security assertion) </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/06/14/WS-Federation-quickstart-for-WSE-3.0/">WS-Federation Quickstart for WSE 3.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-06-14T00:00:00-03:00" pubdate data-updated="true">Jun 14<span>th</span>, 2006</time>
        
         | <a href="/blog/2006/06/14/WS-Federation-quickstart-for-WSE-3.0/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Microsoft has recently released a WS-Federation sample based on the SAML
implementation for WSE 3.0.\
This sample adds some new cool features to the SAML implementation and
shows a scenario similar to what I described a couple of months ago in
this <a href="/cibrax/archive/2006/02/02/437180.aspx" title="post">post</a>.</p>

<p>These are some of the features provided in this sample,</p>

<p>​1. SAML token encryption based on a configuration setting. This setting
basically allows encrypting the attributes\
in the token using a secret key shared between the STS and the service.\
2. SAML authorization assertions. In addition to the common attribute
assertions, the SAML token now supports authorization assertions, which
are useful to describe permissions over different resources (For
example, the owner of this token is allowed to read the financial
files). The quickstart also provides an WSE authorization assertion to
enforce some of these permissions in the SAML token.\
3. Custom SAML token managers. These token managers were specifically
designed for this sample, but they are a good starting point if you want
to know more about the different approaches to customize a SAML token
manager.</p>

<p>Download the sample from this
<a href="http://www.microsoft.com/downloads/details.aspx?familyid=630ad3a5-05ca-4c24-a50a-9e7007323ec2&amp;displaylang=en" title="location">location</a> </p>

<p>Enjoy it :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/05/14/446352/">New Work - New Life</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-05-14T00:00:00-03:00" pubdate data-updated="true">May 14<span>th</span>, 2006</time>
        
         | <a href="/blog/2006/05/14/446352/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A month ago, a person from the Inter-American development bank offered
me a job as .NET consultant in that bank.</p>

<p>After thinking a while, I decided to accept his offer and travel to
Washington DC to starting work there in a project to develop some web
applications and provide consulting in .NET development.</p>

<p>This decision was really hard for me since it implied two important
things, working abroad in a completely different country and leaving a
wonderful company, Lagash.</p>

<p>The years I worked in Lagash were awesome, I had to chance to work with
the Microsoft P&amp;P team in different projects like application blocks,
application frameworks and quickstarts, which gave me a deep knowledge
and experience with the .NET platform and I very grateful to the</p>

<p>Lagash guys.</p>

<p>I think it is the best company in Argentina to work in software
development with Microsoft technologies and you always will find good
challenges there.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/04/19/443402/">WSE and WCF Interop Sample</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-04-19T00:00:00-03:00" pubdate data-updated="true">Apr 19<span>th</span>, 2006</time>
        
         | <a href="/blog/2006/04/19/443402/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Yes, I know, <a href="http://blogs.msdn.com/mfussell/">Mark Fusell</a> has
already demonstrated the interoperability between WSE and WCF many
times. This is another example that shows a WSE client consuming a WCF
service. The client and the service, both use a AnonymousForCertificate
turn-key assertion.</p>

<p>You can download it from this
<a href="/images/legacy/WSEAndIndigo.zip" title="location">location</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/04/12/442679/">The &quot;Service Factory&quot; Project Is Out</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-04-12T00:00:00-03:00" pubdate data-updated="true">Apr 12<span>th</span>, 2006</time>
        
         | <a href="/blog/2006/04/12/442679/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Are you wondering yourself how to build service oriented applications
using the best practices in the market ?. In that case, you should
definitively take a look to this new project <a href="http://www.gotdotnet.com/codegallery/codegallery.aspx?id=6fde9247-53a8-4879-853d-500cd2d97a83" title="Web Service Software Factory">Web Service Software
Factory</a> 
from the Microsoft P&amp;P team. It was announced last week by Don Smith and
Jason Hogg in the Microsoft Canadian Architecture Forum.</p>

<p>\
As a part of this project, I have been working with Jason in some code
samples to show different security patterns for WCF (These patterns were
previously published for WSE 3.0).\
Other people in the development team are also working with GAT to give
tooling support and automate common tasks involved in the development of
SOA applications. (This part is really important since WCF or ASMX does
not offer good tooling support for the moment).</p>

<p>\
These are some members of the project who are also blogging,</p>

<ul>
<li><a href="http://staff.southworks.net/blogs/matiaswoloski/archive/2006/04/06/ServiceBatWorkspace.aspx" title="Matias Woloski">Matias
Woloski</a></li>
<li><a href="http://blogs.thinktecture.com/cweyer/archive/2006/04/05/414452.aspx" title="Christian Weyer">Christian
Weyer</a></li>
<li><a href="http://blogs.msdn.com/thehoggblog/archive/2006/04/03/567323.aspx" title="Jason Hogg">Jason
Hogg</a></li>
<li><a href="http://www.edwardbakker.nl/PermaLink,guid,1c610c51-8d58-411f-a874-f6342c3db22e.aspx" title="Edward Bakker">Edward
Bakker</a></li>
<li><a href="http://blogs.msdn.com/donsmith/" title="Don Smith">Don Smith</a></li>
</ul>


<p>I will be posting more about this exciting project soon.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/24/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/22/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/10/20/do-not-version-urls/">Do Not Version Urls</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/23/selfhost-utilities/">SelfHost Utilities</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/23/appfabric-outputcaching/">AppFabric OutputCaching</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/31/making-ajax-calls-with-hawk-authentication-to-asp-dot-net-web-api/">Making Ajax Calls With Hawk Authentication to ASP.NET Web API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/13/coordinating-async-work-in-node-dot-js/">Coordinating Async Work in Node.js</a>
      </li>
    
  </ul>
</section>
 <a href="http://feeds.feedburner.com/cibrax"><img src="http://feeds.feedburner.com/~fc/cibrax?bg=FF3300&amp;fg=000000&amp;anim=0" style="border:0" alt="" /></a>

 <script type="text/javascript" language="javascript" src="http://twittercounter.com/embed/?username=cibrax&style=white"></script>
<a href="https://mvp.microsoft.com/en-us/mvp/Pablo%20Cibraro-33800"><img src="/images/mvp.gif" border="0" /></a>
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/pcibraro">@pcibraro</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pcibraro',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Cibrax -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'cibrax';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
