
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pablo Cibraro (Cibrax)</title>
  <meta name="author" content="Cibrax">

  
  <meta name="description" content="One of the blog&rsquo;s readers from Italy, Fabio
Cozzolino has written a interesting
host for WCF that gets and merges configuration from different &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cibrax.me/blog/page/20">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/cibrax" rel="alternate" title="Pablo Cibraro (Cibrax)" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44468149-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Pablo Cibraro (Cibrax)</a></h1>
  
    <h2>All about software development.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/cibrax" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:cibrax.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/12/24/configuration-merge-for-wcf/">Configuration Merge for WCF</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-12-24T00:00:00-03:00" pubdate data-updated="true">Dec 24<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/12/24/configuration-merge-for-wcf/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the blog&rsquo;s readers from Italy, <a href="http://dotnetside.org/blogs/fabio/">Fabio
Cozzolino</a> has written a interesting
host for WCF that gets and merges configuration from different
configuration files. You can download the code from <a href="http://dotnetside.org/blogs/fabio/archive/2007/12/15/Merge-di-file-di-configurazione-in-WCF.aspx">his
post</a>,
which is completely in Italian. (Anyway, the code is not, it is
English).</p>

<p>This could be a good solution to separate the configuration in logical
partitions or divisions, and then, have a central host that consolidates
all the configuration (It is a server side solution).  </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/12/13/wcf-dependency-injection-behavior/">WCF Dependency Injection Behavior</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-12-13T00:00:00-03:00" pubdate data-updated="true">Dec 13<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/12/13/wcf-dependency-injection-behavior/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Many times the services are just part of a service layer interface or
facade that only delegate calls to other components in lower layers,
such as entity translators, business logic components, data access
components or service agents that work as proxy with other systems. To
clarify more this point, this is how the Patterns &amp; Practices team
envisioned  a general multi-layer architecture for .NET applications,
<a href="http://blogs.msdn.com/donsmith/archive/2006/07/21/673481.aspx">http://blogs.msdn.com/donsmith/archive/2006/07/21/673481.aspx</a></p>

<p>When this happens, the ideal scenario to test the service code is to
replace the dependencies on lower layers by mocks or stubs objects and
focus our unit tests in the service code only. Fortunately, the
Dependency Injection pattern comes to help us here. Oran Dennison
already discussed a similar approach in this excellent post,
<a href="http://orand.blogspot.com/2006/10/wcf-service-dependency-injection.html">http://orand.blogspot.com/2006/10/wcf-service-dependency-injection.html</a>.</p>

<p>During the course of this post I will take a different path using the
&ldquo;Dependency Injection Container&rdquo; sample that comes with <a href="http://www.codeplex.com/ObjectBuilder">Object
Builder</a> . This sample also
includes good documentation about the supported features.</p>

<p>So, suppose we have a service implementation with the following
dependencies:</p>

<p>[ServiceContract(Namespace =
<a href="http://microsoft.servicemodel.samples/">http://Microsoft.ServiceModel.Samples</a>)]</p>

<p>public interface ICustomer</p>

<p>{</p>

<p>   [OperationContract]</p>

<p>   string GetFullName(string customerId);</p>

<p>}</p>

<p> </p>

<p>public class CustomerService : ICustomer</p>

<p>{</p>

<p>  ICustomerBusinessComponent businessComponent;</p>

<p> </p>

<p>  public CustomerService(ICustomerBusinessComponent businessComponent)</p>

<p>  {</p>

<p>    this.businessComponent = businessComponent;</p>

<p>  }</p>

<p> </p>

<p>  public string GetFullName(string customerId)</p>

<p>  {</p>

<p>    return businessComponent.GetFullName(customerId);</p>

<p>  }</p>

<p>}</p>

<p> </p>

<p>public interface ICustomerDataAccess</p>

<p>{</p>

<p>  string GetFullName(string customerId);</p>

<p>}</p>

<p> </p>

<p>public class CustomerDataAccess : ICustomerDataAccess</p>

<p>{</p>

<p>  public CustomerDataAccess()</p>

<p>  {</p>

<p>  }</p>

<p> </p>

<p>  public string GetFullName(string customerId)</p>

<p>  {</p>

<p>    return &ldquo;FOO&rdquo;;</p>

<p>  }</p>

<p>}</p>

<p>As you can see in the code above, our service has a direct dependency
with a business component, and at the same time, our business component
has a dependency with another component in the data access layer. What
we want to do here is to inject both dependencies at runtime using the
Dependency injection pattern.</p>

<p>The equivalent code with the Dependency Container looks could be,</p>

<p>DependencyContainer container = new DependencyContainer();</p>

<p> </p>

<p>container.RegisterTypeMapping&lt;ICustomerBusinessComponent,
CustomerBusinessComponent>();</p>

<p>container.RegisterTypeMapping&lt;ICustomerDataAccess,
CustomerDataAccess>();</p>

<p> </p>

<p>CustomerService service = container.Get&lt;CustomerService>();</p>

<p>Quite easy, the only requirement is the mapping, otherwise the container
will not know how to create instances of the interfaces. Now, let&rsquo;s move
forward to try configuring this in WCF using a behavior as extensibility
point. WCF supports an extension called IInstanceProvider that controls
the lifecycle of a WCF service instance. We will use one this provider
to hook up our custom code and inject the dependencies at runtime.</p>

<p>public class DIInstanceProvider : IInstanceProvider</p>

<p>{</p>

<p>  private Type serviceType;</p>

<p>  List&lt;TypeMapping> typeMappings;</p>

<p> </p>

<p>  public DIInstanceProvider(Type serviceType, List&lt;TypeMapping>
typeMappings)</p>

<p>  {</p>

<p>    this.serviceType = serviceType;</p>

<p>    this.typeMappings = typeMappings;</p>

<p>  }</p>

<p> </p>

<p>  public object GetInstance(InstanceContext instanceContext)</p>

<p>  {</p>

<p>    return GetInstance(instanceContext, null);</p>

<p>  }</p>

<p> </p>

<p>  public object GetInstance(InstanceContext instanceContext, Message
message)</p>

<p>  {</p>

<p>    DependencyContainer container = new DependencyContainer();</p>

<p> </p>

<p>    foreach (TypeMapping typeMapping in this.typeMappings)</p>

<p>    {</p>

<p>      container.RegisterTypeMapping(typeMapping.TypeRequested,
typeMapping.TypeToBuild);</p>

<p>    }</p>

<p> </p>

<p>    return container.Get(this.serviceType);</p>

<p>  }</p>

<p> </p>

<p>  public void ReleaseInstance(InstanceContext instanceContext, object
instance)</p>

<p>  {</p>

<p> </p>

<p>  }</p>

<p>}</p>

<p> </p>

<p>The typeMapping that you can see there in the code are extensions that
we are going to set up through configuration. This class basically
represents a mapping between a requested type (Which usually is an
interface) and the type to build by the object builder (Which usually is
the concrete implementation).</p>

<p>public class TypeMapping</p>

<p>{</p>

<p>  private Type typeRequested;</p>

<p>  private Type typeToBuild;</p>

<p> </p>

<p>  public TypeMapping(Type typeRequested, Type typeToBuild)</p>

<p>  {</p>

<p>    this.typeRequested = typeRequested;</p>

<p>    this.typeToBuild = typeToBuild;</p>

<p>  }</p>

<p> </p>

<p>  public Type TypeRequested</p>

<p>  {</p>

<p>    get { return typeRequested; }</p>

<p>  }</p>

<p> </p>

<p>  public Type TypeToBuild</p>

<p>  {</p>

<p>    get { return typeToBuild; }</p>

<p>  }</p>

<p>}</p>

<p>Once we have the behavior implementation, the final step is to configure
it in our application. This can be done as follows,</p>

<p>&lt;behaviors></p>

<p>      &lt;serviceBehaviors></p>

<p>        &lt;behavior name=&ldquo;Behaviors1&rdquo;></p>

<p>          &lt;dependencyInjection></p>

<p>            &lt;typeMappings></p>

<p>              &lt;add name=&ldquo;DataAccess&rdquo;
typeRequested=&ldquo;SampleService.ICustomerDataAccess, SampleService&rdquo;
typeToBuild=&ldquo;SampleService.CustomerDataAccess, SampleService&rdquo;/></p>

<p>              &lt;add name=&ldquo;BusinessComponent&rdquo;
typeRequested=&ldquo;SampleService.ICustomerBusinessComponent, SampleService&rdquo;
typeToBuild=&ldquo;SampleService.CustomerBusinessComponent, SampleService&rdquo;/></p>

<p>            &lt;/typeMappings></p>

<p>          &lt;/dependencyInjection></p>

<p>        &lt;/behavior></p>

<p>      &lt;/serviceBehaviors>   </p>

<p>&lt;/behaviors></p>

<p>The configuration looks simple, I just mapped two interfaces to the real
implementations (Which could be replaced during testing through mocks or
stub objects). No additional code needed for the WCF service :&ndash;)</p>

<p>As a final comment, the dependency container also supports method
injection (This is to inject the dependencies that are arguments of a
method) and setter injections (This is to inject dependencies through
property setters).</p>

<p>Download the complete sample from this
<a href="/images/legacy/WCFDependencyInjection.zip">location</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/11/30/simple-sharing-extensions-for-net/">Simple Sharing Extensions for .NET</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-11-30T00:00:00-03:00" pubdate data-updated="true">Nov 30<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/11/30/simple-sharing-extensions-for-net/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As I mentioned in a previous post, I have been very busy lately working
with <a href="http://weblogs.asp.net/cazzu">Daniel</a>,
<a href="http://weblogs.asp.net/marianor/">Mariano</a> and other guys here in
Clarius on an open-source implementation of <a href="http://www.codeplex.com/sse">Simple Sharing Extensions
for .NET</a>. The architecture of the project
is still evolving, many changes have been introduced since the the first
release, and it will continue this way as long as we find things to
improve or new features are added. For this reason is that your feedback
is quite important for us at this point.</p>

<p> </p>

<p><img src="/images/legacy/SSE_Framework.jpg" alt="" /></p>

<p> </p>

<p>As the diagram above shows, we basically have three main parts or
components that conforms to our architecture:</p>

<p>​1. SSE Model Classes: They represent the classes needed to parse and
maintain the SSE metadata. In this group, you can find classes such as
Sync to represent the synchronization history, XmlItem that contains the
item xml payload or Item, which is a combination of a payload with sync
metadata.</p>

<p>​2. Sync Engine: It represents the synchronization engine that process
and applies the SSE rules to the items at runtime. It basically receives
items from two different sources or repositories and makes a complete
merge, determining new item additions, deletions, modifications or
conflicts, when an item was modified in both sources according to the
SSE rules.</p>

<p>​3. Repositories: This is the part of the architecture that can be
extended, and where the developers can have an opportunity to get their
hands dirty. In a few words, a repository represents a source of Items
that contains an xml payload and sync metadata. It is responsible to
provide and maintain that information in a underline storage, which can
be memory, files, databases, or any other kind of storage. Here, you can
also find an specific kind of repository, a CompoundRepository, which
implements the Repository API and delegates the work to two new classes,
XmlRepository and SyncRepository. The first one is only responsible for
maintaining application specific data or payloads, and the second one
for the sync metadata, the CompoundRepository then, knows how to
correlate both parts (the payload and the sync info) through the SSE
identifier that they have in common.</p>

<p>So, depending on the sync scenario, you can just implement a part of a
repository (Deriving from XmlRepository or SyncRepository) or a complete
repository (Deriving from Repository).</p>

<p>For the moment, there is only a SyncRepository that keeps the sync
metadata in a database (Access, SQL Server or SQL CE), but more
repositories will be available soon.</p>

<p>Just to have an idea of how a synchronization scenario looks like, we
could have for example two repositories, one that knows to how to read
and maintain information about outlook contacts and another repository 
that knows how to publish and retrieve items from the Microsoft Live
Personal SSE service
(<a href="http://sse.mslivelabs.com/">http://sse.mslivelabs.com/</a>). This will
allow us a bidirectional synchronization of outlook contacts using
perhaps the SSE service only as a relay agent.</p>

<p><img src="/images/legacy/SSE_Scenario.jpg" alt="" /></p>

<p>If you are interested in implementing any kind of synchronization
scenario, go ahead and take a look at this project :&ndash;).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/11/22/saml-sts-implementation-for-wse-3-0-reposted/">SAML STS Implementation for WSE 3.0 (Reposted)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-11-22T00:00:00-03:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2007</time>
        
         | <a href="/blog/2007/11/22/saml-sts-implementation-for-wse-3-0-reposted/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the Gotdot.net site disappeared along with the code of this
implementation, my friend <a href="http://blogs.msdn.com/thehoggblog/">Jason
Hogg</a> has kindly published the code
on <a href="http://blogs.msdn.com/thehoggblog/archive/2007/11/20/saml-sts-for-wse-3-0-reposted.aspx">his
blog</a>.</p>

<p>Thanks Jason!!!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/11/22/microsoft-synchronization-framework-and-sse/">Microsoft Synchronization Framework and SSE</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-11-22T00:00:00-03:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2007</time>
        
         | <a href="/blog/2007/11/22/microsoft-synchronization-framework-and-sse/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Microsoft has released the first CTP of the synchronization framework,
it is available to download
<a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=35E8F16E-AAA4-4919-8B3C-1CE4EA1F6552">here</a>.</p>

<p>The idea of this framework is to provide a platform or foundation to
synchronize data across multiple data stores through an extensible
architecture based on providers.</p>

<p>This drop comes with three providers out of the box,</p>

<p>​1. Sync provider for ADO.NET, which is the provider for synchronization
across databases  using ADO.NET.</p>

<p>​2. Sync provider for File System, which can be used to synchronize two
file system locations.</p>

<p>​3. Sync provider for SSE (Simple Sharing Extensions) for
synchronization data against SSE feeds. If you are not familiar with
SSE, it is a lightweight protocol initially defined by <a href="http://rayozzie.spaces.live.com/blog/cns!FB3017FBB9B2E142!285.entry">Ray
Ozzie</a>
that mounts on top of RSS or ATOM to allow for two-way synchronization
among peers. If you are interested in knowing more about this
technology, <a href="http://www.clariusconsulting.net/blogs/kzu/archive/2007/06/26/28072.aspx">Daniel wrote an excellent
post</a>
in his blog a couple of weeks ago. As Daniel mentioned in his post, we
have been participating of an open-source implementation of SSE,
<a href="http://www.codeplex.com/sse/Release/ProjectReleases.aspx?ReleaseId=5301">SimpleSharing-NET</a>
that is available to download in CodePlex.</p>

<p>I will be discussing more about the SimpleSharing-NET architecture in
future posts.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/10/19/loading-the-wcf-configuration-from-different-files-on-the-client-side/">Loading the WCF Configuration From Different Files on the Client Side</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-10-19T00:00:00-03:00" pubdate data-updated="true">Oct 19<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/10/19/loading-the-wcf-configuration-from-different-files-on-the-client-side/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A common problem in WCF that many people face is the impossibility of
loading the client configuration from different configuration files.
This is a common scenario  when the developer wants to
deploy some binaries with along with an independent configuration file
(Which may be in a resource file also) to avoid modifying the main
configuration file. A weeks ago, I described a easy workaround to use
the external configuration files through the use of the configSource
attribute (A mechanism provided by .NET). However, that approach
requires several configuration files to configure an entire WCF channel,
at least three files (client section, bindings and behaviors).</p>

<p>Another approach, which is less common and I will describe in this post,
requires some custom code to extend the ChannelFactory&lt;T> class.</p>

<p>The ChannelFactory&lt;T> provides a virtual method &ldquo;CreateDescription&rdquo;
that can be overridden to create a ServiceEndpoint.</p>

<p> </p>

<p>//</p>

<p>// Summary:</p>

<p>//    Creates a description of the service endpoint.</p>

<p>//</p>

<p>// Returns:</p>

<p>//    The System.ServiceModel.Description.ServiceEndpoint of the
service.</p>

<p>//</p>

<p>// Exceptions:</p>

<p>//   System.InvalidOperatorException:</p>

<p>//    The callback contract is null but the service endpoint requires
one that</p>

<p>//    is non-null.</p>

<p>protected override ServiceEndpoint CreateDescription();</p>

<p>The default implementation of this method basically tries to load
the endpoint configuration from the default configuration file (The file
configured for the default AppDomain). So, the workaround here is to
override that method and load the configuration from another file. It
seems to be pretty easy to do at first glance, but as you will see next,
it requires a lot of plumbing code to make it work.</p>

<p>The first step is to derive our custom channel class from the
ChannelFactory&lt;T> class and add an argument in the constructor to
specify a different configuration file.</p>

<p>/// &lt;summary></p>

<p>/// Custom client channel. Allows to specify a different configuration
file</p>

<p>/// &lt;/summary></p>

<p>/// &lt;typeparam name=&ldquo;T&rdquo;>&lt;/typeparam></p>

<p>public class CustomClientChannel&lt;T> : ChannelFactory&lt;T></p>

<p>{</p>

<p>  string configurationPath;</p>

<p> </p>

<p>  /// &lt;summary></p>

<p>  /// Constructor</p>

<p>  /// &lt;/summary></p>

<p>  /// &lt;param name=&ldquo;configurationPath&rdquo;>&lt;/param></p>

<p>  public CustomClientChannel(string configurationPath) : base(typeof(T))</p>

<p>  {</p>

<p>    this.configurationPath = configurationPath;</p>

<p>    base.InitializeEndpoint((string)null, null);</p>

<p>  }</p>

<p>As you can see, a call to the method InitialiazeEndpoint of the base
class is required. That method will automatically call to our
CreateDescription method to configure the service endpoint.</p>

<p>/// &lt;summary></p>

<p>/// Loads the serviceEndpoint description from the specified
configuration file</p>

<p>/// &lt;/summary></p>

<p>/// &lt;returns>&lt;/returns></p>

<p>protected override ServiceEndpoint CreateDescription()</p>

<p>{</p>

<p>   ServiceEndpoint serviceEndpoint = base.CreateDescription();</p>

<p> </p>

<p>   ExeConfigurationFileMap map = new ExeConfigurationFileMap();</p>

<p>   map.ExeConfigFilename = this.configurationPath;</p>

<p> </p>

<p>   Configuration config =
ConfigurationManager.OpenMappedExeConfiguration(map,
ConfigurationUserLevel.None);</p>

<p>   ServiceModelSectionGroup group =
ServiceModelSectionGroup.GetSectionGroup(config);</p>

<p> </p>

<p>   ChannelEndpointElement selectedEndpoint = null;</p>

<p> </p>

<p>   foreach (ChannelEndpointElement endpoint in group.Client.Endpoints)</p>

<p>   {</p>

<p>      if (endpoint.Contract ==
serviceEndpoint.Contract.ConfigurationName)</p>

<p>      {</p>

<p>        selectedEndpoint = endpoint;</p>

<p>        break;</p>

<p>      }</p>

<p>    }</p>

<p> </p>

<p>    if (selectedEndpoint != null)</p>

<p>    {</p>

<p>      if (serviceEndpoint.Binding == null)</p>

<p>      {</p>

<p>        serviceEndpoint.Binding =
CreateBinding(selectedEndpoint.Binding, group);</p>

<p>      }</p>

<p> </p>

<p>      if (serviceEndpoint.Address == null)</p>

<p>      {</p>

<p>        serviceEndpoint.Address = new
EndpointAddress(selectedEndpoint.Address,
GetIdentity(selectedEndpoint.Identity),
selectedEndpoint.Headers.Headers);</p>

<p>      }</p>

<p> </p>

<p>      if (serviceEndpoint.Behaviors.Count == 0 &amp;&amp;
selectedEndpoint.BehaviorConfiguration != null)</p>

<p>      {</p>

<p>        AddBehaviors(selectedEndpoint.BehaviorConfiguration,
serviceEndpoint, group);</p>

<p>      }</p>

<p> </p>

<p>      serviceEndpoint.Name = selectedEndpoint.Contract;</p>

<p>    }</p>

<p> </p>

<p>    return serviceEndpoint;</p>

<p> </p>

<p>}</p>

<p> </p>

<p>CreateDescription is the core method where we create the service
endpoint using the configuration file specified in the constructor
method.</p>

<p>And the last step, is to use our custom channel in the client
application instead of the base channel provided by WCF.</p>

<p>CustomClientChannel&lt;ICalculator> channel = new
CustomClientChannel&lt;ICalculator>(&ldquo;OtherConfig.config&rdquo;);</p>

<p>ICalculator client = channel.CreateChannel();</p>

<p>The code below uses the ICalculator contract  that comes with the WCF
sdk samples.</p>

<p>You can download the <a href="/images/legacy/CustomChannel.zip">complete sample
here</a></p>

<p> </p>

<p> </p>

<p> </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/10/17/clarius-is-hiring/">Clarius Is Hiring!!!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-10-17T00:00:00-03:00" pubdate data-updated="true">Oct 17<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/10/17/clarius-is-hiring/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Want to work at a growing, high energy services-software company?
Clarius Consulting is looking for the candidates to help us fill the
following positions:</p>

<p>At Clarius we do all kind of interesting and exciting work. We help
customers get up to speed with .Net by providing superb training,
mentoring and consulting. We also write a lot of code. We present @
several conferences (locally and worldwide) and we write articles and
books.</p>

<p><strong>Senior Software Developers.</strong></p>

<p>The position is based in Buenos Aires, Argentina (Local candidates
only). Selected candidates should possess experience in many of the
following disciplines:</p>

<p>ASP.NET, ADO.NET \
Winforms .NET development (C#, preferably; MDI-based applications) and
Webforms \
XML-related standards \
SQL Server 2000-2005 \
Explicit/Implicit stored procedures. \
Web Services / .NET remoting / WCF\
COM+ / .NET interoperability \
Migration from COM+ to .NET</p>

<p>If you are interested, drop me a line with your resume (pci at
clariusconsulting DOT net)</p>

<p>Thanks!!!.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/10/08/certificate-access-error-for-wcf-hosted-services/">Certificate Access Error for WCF Hosted Services</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-10-08T00:00:00-03:00" pubdate data-updated="true">Oct 8<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/10/08/certificate-access-error-for-wcf-hosted-services/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>The problem appears when a WCF Service hosted in an IIS tries to load a
certificate from the Windows Certificates Store with the account of the
Application Pool where the service runs, and the account’s profile is
not previously loaded. When a user logs on interactively, the system
automatically loads the user&rsquo;s profile. If a service or an application
impersonates a user, the system does not load the user&rsquo;s profile.
Therefore, the service or application should load the user&rsquo;s profile
with LoadUserProfile.</em></p>

<p><em>When this happens the operation throws the following exception:</em></p>

<p><em>System.Security.Cryptography.CryptographicException: The system cannot
find the file specified. [VIA <a href="http://marianosz.blogspot.com/">Mariano Sanches
Blog</a>]</em></p>

<p> </p>

<p>The problem is basically related to the method that WCF uses to encrypt
the Secure conversation cookie. By default, WCF encrypts the cookie
using DPAPI (Current User), so the user profile should be loaded in
order to use that encryption method.</p>

<p>Mariano mentioned one of the workarounds, which requires to load
the user&rsquo;s profile of the account configured in the IIS Application pool
using some windows API&rsquo;s.</p>

<p>Another workaround is to change the method used by WCF to encrypt
the SCT cookie and eliminate the DPAPI dependency. An advantage of this
method is that it works fine for Web Farm scenarios.</p>

<p>Fortunately, WCF provides an extension to change the method used to
encrypt and serialize the SCT Cookie. This extension is a
SecurityStateEncoder and it can be plugged-in by code in the service
host:</p>

<p><strong>serviceHost.Credentials.SecureConversationAuthentication.SecurityStateEncoder</strong></p>

<p>You can find an excellent example about how to implement a custom
SecurityStateEncoder
<a href="http://wcf.netfx3.com/files/folders/authorization/entry11436.aspx">here</a>,
(WCF.Netfx3.com web site, WS-SC With State Encoder)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/10/03/nulltransport-for-wcf/">NullTransport for WCF</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-10-03T00:00:00-03:00" pubdate data-updated="true">Oct 3<span>rd</span>, 2007</time>
        
         | <a href="/blog/2007/10/03/nulltransport-for-wcf/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As usual, Roman Kiss continues doing great stuffs for WCF. He has
recently published a new NullTransport for WCF in CodeProject.</p>

<p>This transport is really useful for In-Process communication when the
client and the service run on the same windows process. Before having
this transport, the recommended transport for scenario was Named pipes.</p>

<p>Read more about this transport in the article he published here
<a href="http://www.codeproject.com/WCF/NullTransportForWCF.asp">http://www.codeproject.com/WCF/NullTransportForWCF.asp</a></p>

<p>Enjoy!!.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/08/29/sending-attachments-with-wcf/">Sending Attachments With WCF</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-08-29T00:00:00-03:00" pubdate data-updated="true">Aug 29<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/08/29/sending-attachments-with-wcf/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>WCF mainly supports two modes to send attachments in a efficient way, an
streamed mode and a buffered/chunked mode.</p>

<p>In the first mode, the transport basically transfers large amount of
data using small buffers with a minimal overhead. This mode of
transferring the data has some drawbacks, for instance it does not
support message security (Only transport security through SSL), or the
robustness of reliable messaging. On the other hand, interoperability is
easier to archive since no WS-* standard is used. Nicholas describes
the restrictions very well on this post,
<a href="http://blogs.msdn.com/drnick/archive/2006/03/31/565558.aspx">http://blogs.msdn.com/drnick/archive/2006/03/31/565558.aspx</a></p>

<p>I will show a simple example that uses the Streamed mode to upload a
file to the server. The contract for this service looks as follow:</p>

<p>[ServiceContract()]</p>

<p>public interface IFileTransferService</p>

<p>{</p>

<p>  [OperationContract(IsOneWay = true)]</p>

<p>  void Upload(FileTransferRequest request);</p>

<p>}</p>

<p>As Nicholas mentioned on his post, when this mode is used, only the
stream object can go in the message body, the rest of the arguments must
go as headers. That is the main reason of using a message contract
FileTransferRequest.</p>

<p>[MessageContract()]</p>

<p>public class FileTransferRequest</p>

<p>{</p>

<p>  [MessageHeader(MustUnderstand = true)]</p>

<p>  public string FileName;</p>

<p> </p>

<p>  [MessageBodyMember(Order = 1)]</p>

<p>  public System.IO.Stream Data;</p>

<p> </p>

<p>}</p>

<p>Processing large files with buffered transfer does not scale well, and
could be something impossible to do because of the high memory
requeriments on the client and server side. The workaround for this is
chunking combined with reliable messaging, which basically split large
files in small fragments (For instance, 64 o 128 KB fragments) and use
reliable messaging to assure the ordered delivery of those fragments.
WCF does not provide a transport with chunk support by default, but
fortunately it is implemented in an example of the SDK.</p>

<p>This simple is under the folder [SDK
folder]\Samples\Extensibility\Channels\ChunkingChannel</p>

<p>In addition to the mode used to transfer the streams, WCF also supports
the concept of message encoders, which basically serializes a
xml infoset into a stream of bytes using an specific encoding. WCF ships
by default with three encoders, Text, Binary and MTOM. Any of
the features provided by these encoders should be considered carefully
to avoid performance issues in the application.</p>

<p>The Text and MTOM encoders provides interoperability with other
platforms while the Binary formatter uses a proprietary format. Anyway,
let&rsquo;s discuss these types of encoder more in detail:</p>

<p><strong>Text Encoder</strong>: As it name says, it is a text message encoder and
supports both plain XML encoding (For Rest/POST scenarios) as well as
SOAP Encoding. When this encoder is used, the attachments are encoded as
base64 and added as part of the xml message. This transformation to a
base64 encoding makes the final size of the attachments bigger, almost
30% bigger than the original size.</p>

<p><strong>Binary Encoder</strong>: It uses a compact binary format, optimized for a WCF
to WCF communication. This encoder is the recommend one for sending
attachments when interoperability is not a requirement.</p>

<p><strong>MTOM Encoder</strong>:  It uses a Message Transmission Optimization Mechanism
(MTOM) encoding. MTOM is a efficient technology for transmitting large
blocks of binary data in a soap message as-is, without conversion to
text. In addition, MTOM is a interoperable standard and also supports
Message Security (WS-Security). When Message Security is used, WCF
basically performs the following steps:</p>

<p>​1. Encodes all the blocks of binary data as Base64.</p>

<p>​2. Applies message security (Integrity and Confidentiality) to the
resulting block of Base64 text.</p>

<p>​3. Adds the security headers to the soap message</p>

<p>​4. Transmits the binary data separately from the soap message (The
Base64 data created in the step 2 is discarded)</p>

<p>For more details about moving large amounts of data and final
recommendations, see this <a href="http://blogs.msdn.com/yassers/archive/2006/01/21/515887.aspx">excellent
post</a>
of <a href="http://blogs.msdn.com/yassers/">Yasser Shohoud</a>.</p>

<p>Examples,</p>

<p><a href="/images/legacy/BufferedUpload.zip">Buffered Upload</a></p>

<p><a href="/images/legacy/StreamedUpload.zip">Streamed Upload</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/21/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/19/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/10/20/do-not-version-urls/">Do Not Version Urls</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/23/selfhost-utilities/">SelfHost Utilities</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/23/appfabric-outputcaching/">AppFabric OutputCaching</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/31/making-ajax-calls-with-hawk-authentication-to-asp-dot-net-web-api/">Making Ajax Calls With Hawk Authentication to ASP.NET Web API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/13/coordinating-async-work-in-node-dot-js/">Coordinating Async Work in Node.js</a>
      </li>
    
  </ul>
</section>
 <a href="http://feeds.feedburner.com/cibrax"><img src="http://feeds.feedburner.com/~fc/cibrax?bg=FF3300&amp;fg=000000&amp;anim=0" style="border:0" alt="" /></a>

 <script type="text/javascript" language="javascript" src="http://twittercounter.com/embed/?username=cibrax&style=white"></script>
<a href="https://mvp.microsoft.com/en-us/mvp/Pablo%20Cibraro-33800"><img src="/images/mvp.gif" border="0" /></a>
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/pcibraro">@pcibraro</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pcibraro',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Cibrax -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'cibrax';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
